<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!--#include partials/head-theme.html-->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon" type="image/webp" href="/assets/logos/new/kexo.webp" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler-flags.min.css" />
  <link rel="stylesheet" href="/tabler-theme.css" />
  <link rel="stylesheet" href="/custom.css" />
  <link rel="stylesheet" href="/diagnostics-modal.css" />
  <title>Kexo · Settings</title>
  <style>
    .settings-panel { display: none; }
    .settings-panel.active { display: block; }
    .list-group.list-group-transparent .list-group-item.active:hover { text-decoration: none !important; }
    .settings-integrations-panel { display: none; }
    .settings-integrations-panel.active { display: block; }
    .settings-kpis-layout-panel { display: none; }
    .settings-kpis-layout-panel.active { display: block; }
    .settings-kexo-panel { display: none; }
    .settings-kexo-panel.active { display: block; }
    .settings-insights-layout-panel { display: none; }
    .settings-insights-layout-panel.active { display: block; }
    .settings-attribution-panel { display: none; }
    .settings-attribution-panel.active { display: block; }
      .settings-layout-panel { display: none; }
      .settings-layout-panel.active { display: block; }
    .settings-charts-accordion .accordion-item + .settings-charts-group-label { margin-top: 1rem; }
    .settings-charts-group-label { font-size: .74rem; letter-spacing: .06em; text-transform: uppercase; color: var(--tblr-secondary, #66758c); margin: .35rem 0 .45rem; }
    .settings-charts-card-body { padding: .25rem 0; }
    .settings-charts-color-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: .55rem; }
    .settings-charts-color-field-row { display: flex; align-items: center; gap: .5rem; }
    .settings-charts-color-field { display: flex; flex-direction: column; gap: .35rem; }
    .settings-charts-color-swatch { width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--tblr-border-color, #e6e7e9); flex-shrink: 0; display: block; }
    .settings-charts-preview-wrap { border: 1px dashed var(--tblr-border-color, #e6e7e9); border-radius: .55rem; padding: .75rem; background: var(--tblr-bg-surface-secondary, #f7f9fc); }
    .settings-charts-preview-canvas { width: 100%; min-height: 150px; }
    .settings-kpi-preview-card { border: 1px solid var(--tblr-border-color, #e6e7e9); border-radius: .5rem; background: #fff; padding: .75rem; }
    .settings-kpi-preview-head { display: flex; align-items: center; justify-content: space-between; gap: .5rem; margin-bottom: .35rem; }
    .settings-kpi-preview-title { font-size: .82rem; color: var(--tblr-secondary, #66758c); }
    .settings-kpi-preview-value { font-size: 1.2rem; font-weight: 700; margin-bottom: .45rem; }
    .settings-kpi-preview-delta { display: inline-flex; align-items: center; gap: .3rem; font-size: 14px; font-weight: 500; color: #2fb344; }
    .settings-layout-accordion .accordion-button { font-size: 16px; }
    .settings-layout-accordion .accordion-button code { font-size: .72rem; }
    .settings-layout-accordion .kexo-settings-accordion-chevron {
      font-size: 14px;
      color: #444;
      flex-shrink: 0;
      display: inline-flex;
      align-items: center;
      margin-right: 0.35rem;
      transition: transform 0.2s ease;
    }
    .settings-layout-accordion .accordion-button:not(.collapsed) .kexo-settings-accordion-chevron {
      transform: rotate(180deg);
    }
    .settings-layout-table-card .card-header { background: var(--tblr-bg-surface-secondary, #f6f8fb); }
    .settings-layout-table-card .card-title { font-size: .95rem; }
    .settings-layout-color-preview {
      width: 100%;
      min-height: 34px;
      border-radius: var(--tblr-border-radius, .375rem);
      border: 1px solid var(--tblr-border-color, #e6e7e9);
    }
    .admin-panel { display: none; }
    .admin-panel.active { display: block; }
    .admin-users-table td { vertical-align: middle; }
    .admin-users-email { font-weight: 600; }
    .admin-users-meta { font-size: 12px; color: var(--tblr-secondary, #66758c); }
    .admin-users-actions { display: flex; gap: .4rem; flex-wrap: wrap; justify-content: flex-end; }
    .admin-users-badge { font-size: .7rem; letter-spacing: .02em; text-transform: uppercase; }
    .admin-users-pane { display: none; }
    .admin-users-pane.active { display: block; }
    @media (max-width: 768px) {
      .settings-charts-color-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body class="" data-page="settings">
  <!--#include partials/header.html-->
  <!--#include partials/page-body-start.html-->

  <div class="row">
    <!-- Left nav: category tablist -->
    <div class="col-lg-3 mb-4 mb-lg-0" role="presentation">
      <div class="list-group list-group-transparent" id="settings-category-tablist" role="tablist" aria-label="Settings categories">
        <a href="/settings?tab=kexo" class="list-group-item list-group-item-action d-flex align-items-center active" id="settings-tab-kexo" role="tab" data-settings-tab="kexo" aria-selected="true" aria-controls="settings-panel-kexo">
          <i class="fa-thin fa-palette me-2" data-icon-key="settings-tab-theme" aria-hidden="true"></i>
          Kexo
        </a>
        <a href="/settings?tab=integrations" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-integrations" role="tab" data-settings-tab="integrations" aria-selected="false" aria-controls="settings-panel-integrations">
          <i class="fa-thin fa-plug me-2" data-icon-key="settings-tab-integrations" aria-hidden="true"></i>
          Integrations
        </a>
        <a href="/settings?tab=layout" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-layout" role="tab" data-settings-tab="layout" aria-selected="false" aria-controls="settings-panel-layout">
          <i class="fa-thin fa-table-columns me-2" data-icon-key="settings-tab-layout" aria-hidden="true"></i>
          Layout
        </a>
        <a href="/settings?tab=attribution" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-attribution" role="tab" data-settings-tab="attribution" aria-selected="false" aria-controls="settings-panel-attribution">
          <i class="fa-thin fa-map-location-dot me-2" data-icon-key="settings-tab-sources" aria-hidden="true"></i>
          Attribution
        </a>
        <a href="/settings?tab=insights" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-insights" role="tab" data-settings-tab="insights" aria-selected="false" aria-controls="settings-panel-insights">
          <i class="fa-thin fa-chart-pie me-2" data-icon-key="settings-tab-insights" aria-hidden="true"></i>
          Insights
        </a>
        <!-- KEXO_ADMIN_NAV_START -->
        <a href="/settings?tab=admin" class="list-group-item list-group-item-action d-flex align-items-center kexo-admin-only d-none" id="settings-tab-admin" role="tab" data-settings-tab="admin" aria-selected="false" aria-controls="settings-panel-admin">
          <i class="fa-thin fa-user-gear me-2" data-icon-key="settings-tab-admin" aria-hidden="true"></i>
          Admin
        </a>
        <!-- KEXO_ADMIN_NAV_END -->
      </div>
    </div>

    <!-- Right content: category tab panels -->
    <div class="col-lg-9">
      <div id="settings-panel-kexo" class="settings-panel active" role="tabpanel" aria-labelledby="settings-tab-kexo">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-palette me-2" data-icon-key="settings-tab-theme" aria-hidden="true"></i>Kexo</h3>
          </div>
          <div class="card-body">
            <ul class="nav nav-underline mb-3" id="settings-kexo-tabs" role="tablist" aria-label="Kexo">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" id="settings-kexo-tab-general" data-settings-kexo-tab="general" aria-selected="true" aria-controls="settings-kexo-panel-general">General</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-kexo-tab-icons" data-settings-kexo-tab="icons" aria-selected="false" aria-controls="settings-kexo-panel-ui">Icons</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-kexo-tab-header" data-settings-kexo-tab="header" aria-selected="false" aria-controls="settings-kexo-panel-ui">Header</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-kexo-tab-color" data-settings-kexo-tab="color" aria-selected="false" aria-controls="settings-kexo-panel-ui">Color</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-kexo-tab-fonts" data-settings-kexo-tab="fonts" aria-selected="false" aria-controls="settings-kexo-panel-ui">Fonts</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-kexo-tab-notifications" data-settings-kexo-tab="notifications" aria-selected="false" aria-controls="settings-kexo-panel-ui">Notifications</button>
              </li>
            </ul>

            <div id="settings-kexo-panel-general" class="settings-kexo-panel active" role="tabpanel" aria-labelledby="settings-kexo-tab-general">
              <div class="card card-sm mb-3">
                <div class="card-header">
                  <h4 class="card-title"><i class="fa-thin fa-sliders me-2" data-icon-key="settings-tab-general" aria-hidden="true"></i>General</h4>
                </div>
                <div class="card-body">
                  <p class="text-secondary">Read-only environment values plus KPI date label format.</p>
                  <div class="mb-3">
                    <label class="form-label">App URL</label>
                    <input type="text" class="form-control" id="settings-general-app-url" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Admin timezone <span class="badge bg-primary-lt">TODO per-install</span></label>
                    <input type="text" class="form-control" id="settings-general-timezone" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Store domain</label>
                    <input type="text" class="form-control" id="settings-general-shop-domain" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Display domain</label>
                    <input type="text" class="form-control" id="settings-general-display-domain" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Store main URL</label>
                    <input type="text" class="form-control" id="settings-general-store-main" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Ingest URL</label>
                    <input type="text" class="form-control" id="settings-general-ingest-url" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Acquisition mode / DB</label>
                    <input type="text" class="form-control" id="settings-general-traffic-mode" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="settings-general-date-format">KPI date label format</label>
                    <select class="form-select" id="settings-general-date-format">
                      <option value="dmy">English (D/M)</option>
                      <option value="mdy">American (M/D)</option>
                    </select>
                    <div class="form-hint">Controls compact KPI compare labels like <code>16/2 – 16/3</code>.</div>
                  </div>
                  <div class="d-flex align-items-center gap-2 flex-wrap">
                    <button type="button" class="btn btn-primary" id="settings-general-save-btn">Save</button>
                    <span id="settings-general-msg" class="form-hint"></span>
                  </div>
                </div>
              </div>

              <div class="card card-sm">
                <div class="card-header">
                  <h4 class="card-title"><i class="fa-thin fa-image me-2" data-icon-key="settings-tab-assets" aria-hidden="true"></i>Assets</h4>
                </div>
                <div class="card-body">
                  <p class="text-secondary mb-3">Upload/override branding assets (favicon + logos). Saved globally.</p>
                  <form id="settings-assets-form">
                    <div class="row g-3">
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-favicon">Favicon URL override</label>
                        <input type="url" class="form-control" id="settings-asset-favicon" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-favicon" accept="image/png,image/webp,image/jpeg,image/x-icon,image/vnd.microsoft.icon" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="favicon" data-kexo-file="settings-upload-favicon" data-kexo-url="settings-asset-favicon">Upload</button>
                        </div>
                        <div class="form-hint">PNG/ICO recommended.</div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-logo">Header logo URL override</label>
                        <input type="url" class="form-control" id="settings-asset-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-header-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="header_logo" data-kexo-file="settings-upload-header-logo" data-kexo-url="settings-asset-logo">Upload</button>
                        </div>
                        <div class="form-hint">Replaces the top-strip logo across the app.</div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-footer-logo">Footer logo URL override</label>
                        <input type="url" class="form-control" id="settings-asset-footer-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-footer-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="footer_logo" data-kexo-file="settings-upload-footer-logo" data-kexo-url="settings-asset-footer-logo">Upload</button>
                        </div>
                        <div class="form-hint">Replaces the footer center logo.</div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-login-logo">Login logo URL override</label>
                        <input type="url" class="form-control" id="settings-asset-login-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-login-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="login_logo" data-kexo-file="settings-upload-login-logo" data-kexo-url="settings-asset-login-logo">Upload</button>
                        </div>
                        <div class="form-hint">Replaces the logo shown on <code>/app/login</code>.</div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-kexo-fullcolor-logo">Kexo full-color logo URL override</label>
                        <input type="url" class="form-control" id="settings-asset-kexo-fullcolor-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-kexo-fullcolor-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="kexo_logo_fullcolor" data-kexo-file="settings-upload-kexo-fullcolor-logo" data-kexo-url="settings-asset-kexo-fullcolor-logo">Upload</button>
                        </div>
                        <div class="form-hint">Used in Settings → Diagnostics branding blocks.</div>
                      </div>
                    </div>

                    <div class="mt-3">
                      <button type="submit" class="btn btn-primary">Save</button>
                      <span id="settings-assets-msg" class="form-hint ms-2"></span>
                    </div>
                  </form>
                  <p class="text-muted small mt-2 mb-0">Uploads are stored in Cloudflare R2.</p>
                </div>
              </div>
            </div>

            <div id="settings-kexo-panel-ui" class="settings-kexo-panel" role="tabpanel" aria-labelledby="settings-kexo-tab-icons">
              <div class="card card-sm">
                <div class="card-header">
                  <h4 class="card-title" id="settings-theme-title"><i class="fa-thin fa-palette me-2" data-icon-key="settings-tab-theme" aria-hidden="true"></i><span id="settings-theme-title-text">Theme</span></h4>
                </div>
                <div class="card-body" id="settings-theme-panel">
                  <div class="dm-loading">Loading theme…</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-integrations" class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-integrations">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-plug me-2" data-icon-key="settings-tab-integrations" aria-hidden="true"></i>Integrations</h3>
          </div>
          <div class="card-body">
            <p class="text-secondary mb-3">Shopify + Google Ads integration status and controls.</p>
            <ul class="nav nav-underline mb-3" id="settings-integrations-tabs" role="tablist" aria-label="Integrations">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" id="settings-integrations-tab-shopify" data-settings-integrations-tab="shopify" aria-selected="true" aria-controls="settings-integrations-panel-shopify">Shopify</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-integrations-tab-googleads" data-settings-integrations-tab="googleads" aria-selected="false" aria-controls="settings-integrations-panel-googleads">Google Ads</button>
              </li>
            </ul>

            <div id="settings-integrations-panel-shopify" class="settings-integrations-panel active" role="tabpanel" aria-labelledby="settings-integrations-tab-shopify">
              <div class="row g-3">
                <div class="col-12 col-xl-6">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Shopify Auth</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Shop</strong> <span id="settings-int-shopify-shop" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Token</strong> <span id="settings-int-shopify-token" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Stored scopes</strong> <span id="settings-int-shopify-scopes" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Missing scopes</strong> <span id="settings-int-shopify-missing-scopes" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-xl-6">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Truth Sync</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Sync age</strong> <span id="settings-int-shopify-sync-age" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Last sync</strong> <span id="settings-int-shopify-last-sync" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Last error</strong> <span id="settings-int-shopify-last-error" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Pixel</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Installed</strong> <span id="settings-int-pixel-installed" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Pixel ingestUrl</strong> <span id="settings-int-pixel-ingest" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Expected ingestUrl</strong> <span id="settings-int-expected-ingest" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Ingest URL match</strong> <span id="settings-int-pixel-match" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Session mode</strong> <span id="settings-int-session-mode" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div id="settings-integrations-panel-googleads" class="settings-integrations-panel" role="tabpanel" aria-labelledby="settings-integrations-tab-googleads">
              <div class="card card-sm mb-3">
                <div class="card-header"><h4 class="card-title">Google Ads Connection</h4></div>
                <div class="card-body">
                  <div class="mb-2"><strong>Configured</strong> <span id="settings-int-ga-configured" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Connected</strong> <span id="settings-int-ga-connected" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Customer ID</strong> <span id="settings-int-ga-customer-id" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Login Customer ID</strong> <span id="settings-int-ga-login-customer-id" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Developer token</strong> <span id="settings-int-ga-dev-token" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Refresh token</strong> <span id="settings-int-ga-refresh-token" class="text-muted">—</span></div>
                  <div class="mb-3">
                    <label class="form-label small">Account context (optional, for Connect)</label>
                    <div class="row g-2">
                      <div class="col-md-6"><input type="text" class="form-control form-control-sm" id="settings-ga-account-customer-id" placeholder="Customer ID" /></div>
                      <div class="col-md-6"><input type="text" class="form-control form-control-sm" id="settings-ga-account-login-customer-id" placeholder="Login Customer ID" /></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="d-flex align-items-center gap-2 flex-wrap mb-2">
                <a class="btn btn-outline-primary btn-sm" id="settings-ga-connect-btn" href="/api/ads/google/connect?redirect=%2Fsettings%3Ftab%3Dintegrations">Connect</a>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-disconnect-btn">Disconnect</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-test-connection-btn">Test connection</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-status-btn">Status</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-summary-btn">Summary</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-refresh-7d-btn">Refresh 7d</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-refresh-month-btn">Refresh month</button>
                <span id="settings-ga-msg" class="form-hint"></span>
              </div>
              <div class="card card-sm mb-3">
                <div class="card-header"><h4 class="card-title">Conversion goals (Revenue / Profit)</h4></div>
                <div class="card-body">
                  <p class="text-muted small mb-2">Provision UPLOAD_CLICKS conversion actions for postback. Current goals:</p>
                  <pre id="settings-ga-goals-output" class="dm-json-pre small mb-2" style="max-height:120px">—</pre>
                  <button type="button" class="btn btn-outline-primary btn-sm" id="settings-ga-provision-goals-btn">Provision goals</button>
                </div>
              </div>
              <div class="card card-sm mb-3">
                <div class="card-header"><h4 class="card-title">Profit rules</h4></div>
                <div class="card-body">
                  <p class="text-muted small mb-0">Profit conversion value = revenue − configured non-ads costs (ad spend excluded). Configure cost components in Kexo / Business snapshot / Profit rules.</p>
                </div>
              </div>
              <div class="card card-sm mb-3">
                <div class="card-header"><h4 class="card-title">Postback (UploadClickConversions)</h4></div>
                <div class="card-body">
                  <div class="form-check form-switch mb-2">
                    <input class="form-check-input" type="checkbox" id="settings-ga-postback-enabled" />
                    <label class="form-check-label" for="settings-ga-postback-enabled">Enable postback</label>
                  </div>
                  <p class="text-muted small mb-0">When enabled, attributed orders are sent to Google Ads as Revenue and Profit conversions. Default: off.</p>
                </div>
              </div>
              <pre id="settings-ga-output" class="dm-json-pre mb-0">Loading…</pre>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-attribution" class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-attribution">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-map-location-dot me-2" data-icon-key="settings-tab-sources" aria-hidden="true"></i>Attribution</h3>
          </div>
          <div class="card-body">
            <p class="text-secondary mb-3">Map observed tokens (UTMs, referrer host, entry URL params, explicit <code>kexo_attr</code>) into persisted Attribution variants (Channel + Source + Ownership).</p>
            <ul class="nav nav-underline mb-3" id="settings-attribution-tabs" role="tablist" aria-label="Attribution">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" id="settings-attribution-tab-mapping" data-settings-attribution-tab="mapping" aria-selected="true" aria-controls="settings-attribution-panel-mapping">Mapping</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-attribution-tab-tree" data-settings-attribution-tab="tree" aria-selected="false" aria-controls="settings-attribution-panel-tree">Mapped tree</button>
              </li>
            </ul>
            <div id="settings-attribution-panel-mapping" class="settings-attribution-panel active" role="tabpanel" aria-labelledby="settings-attribution-tab-mapping">
              <div id="settings-attribution-mapping-root" class="dm-root">
                <div class="dm-loading-spinner"><div class="report-build-wrap"><div class="spinner-border text-primary" role="status"></div><div class="report-build-title">loading attribution mapping</div></div></div>
              </div>
            </div>
            <div id="settings-attribution-panel-tree" class="settings-attribution-panel" role="tabpanel" aria-labelledby="settings-attribution-tab-tree">
              <div id="settings-attribution-tree-root" class="dm-root">
                <div class="dm-loading-spinner"><div class="report-build-wrap"><div class="spinner-border text-primary" role="status"></div><div class="report-build-title">loading mapped tree</div></div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-insights" class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-insights">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-chart-pie me-2" data-icon-key="settings-tab-insights" aria-hidden="true"></i>Insights</h3>
          </div>
          <div class="card-body">
            <ul class="nav nav-underline mb-3" id="settings-insights-layout-tabs" role="tablist" aria-label="Insights">
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-insights-layout-tab-products" data-settings-insights-layout-tab="products" aria-selected="false" aria-controls="settings-insights-layout-panel-products" disabled tabindex="-1">Products <span class="text-muted small">(coming soon)</span></button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-insights-layout-tab-countries" data-settings-insights-layout-tab="countries" aria-selected="false" aria-controls="settings-insights-layout-panel-countries" disabled tabindex="-1">Countries <span class="text-muted small">(coming soon)</span></button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" id="settings-insights-layout-tab-variants" data-settings-insights-layout-tab="variants" aria-selected="true" aria-controls="settings-insights-layout-panel-variants">Variants</button>
              </li>
            </ul>

            <div id="settings-insights-layout-panel-products" class="settings-insights-layout-panel" role="tabpanel" aria-labelledby="settings-insights-layout-tab-products">
              <p class="text-secondary mb-0">Products controls are planned for a future update.</p>
            </div>
            <div id="settings-insights-layout-panel-countries" class="settings-insights-layout-panel" role="tabpanel" aria-labelledby="settings-insights-layout-tab-countries">
              <p class="text-secondary mb-0">Countries controls are planned for a future update.</p>
            </div>
            <div id="settings-insights-layout-panel-variants" class="settings-insights-layout-panel active" role="tabpanel" aria-labelledby="settings-insights-layout-tab-variants">
              <p class="text-secondary mb-3">Create and manage custom variant mapping tables used by Insights → Variants.</p>
              <div id="settings-insights-variants-root" class="dm-root">
                <div class="dm-loading">Loading variant table mappings…</div>
              </div>
              <div class="mt-3 d-flex align-items-center justify-content-between flex-wrap gap-2">
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <button type="button" class="btn btn-outline-primary" id="settings-insights-variants-suggest-btn">Suggest mappings</button>
                  <button type="button" class="btn btn-outline-danger" id="settings-insights-variants-warnings-btn" disabled>Warnings</button>
                  <button type="button" class="btn btn-outline-primary" id="settings-insights-variants-ignore-btn">Ignored List</button>
                  <button type="button" class="btn btn-outline-primary is-hidden" id="settings-insights-variants-reset-variants-btn">Reset Variants</button>
                </div>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <button type="button" class="btn btn-success" id="settings-insights-variants-save-btn">Save</button>
                </div>
              </div>
              <div class="mt-2"><span id="settings-insights-variants-msg" class="form-hint"></span></div>
              <div class="text-muted small mt-2">Save is allowed even when enabled tables have unmapped in-scope variants. You\u2019ll see warnings to help improve coverage. Overlap is auto-managed by specificity/order, and out-of-scope titles are skipped.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-ignore-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Ignored Variant Titles</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-ignore></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-ignore-body">
              <div class="text-secondary">Loading ignored titles…</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-ignore-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-ignore>Close</button>
                <button type="button" class="btn btn-primary" id="settings-insights-variants-ignore-save-btn">Save changes</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-suggest-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Variant mapping suggestions</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-suggest></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-suggest-body">
              <div class="text-secondary">Loading suggestions…</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-suggest-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-suggest>Close</button>
                <button type="button" class="btn btn-outline-secondary" id="settings-insights-variants-suggest-refresh-btn">Refresh from Shopify</button>
                <button type="button" class="btn btn-primary" id="settings-insights-variants-suggest-apply-btn">Apply selected</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-merge-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Merge variant labels</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-merge></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-merge-body">
              <div class="text-secondary">Loading…</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-merge-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-merge>Cancel</button>
                <button type="button" class="btn btn-primary" id="settings-insights-variants-merge-apply-btn">Merge</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-warnings-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Variants mapping warnings</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-warnings></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-warnings-body">
              <div class="text-secondary">No warnings loaded yet.</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-warnings-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-warnings>Close</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-layout" class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-layout">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-table-columns me-2" data-icon-key="settings-tab-layout" aria-hidden="true"></i>Layout</h3>
          </div>
          <div class="card-body">
            <ul class="nav nav-underline mb-3" id="settings-layout-tabs" role="tablist" aria-label="Layout options">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" id="settings-layout-tab-tables" data-settings-layout-tab="tables" aria-selected="true" aria-controls="settings-layout-panel-tables">Tables</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-layout-tab-charts" data-settings-layout-tab="charts" aria-selected="false" aria-controls="settings-layout-panel-charts">Charts</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-layout-tab-kpis" data-settings-layout-tab="kpis" aria-selected="false" aria-controls="settings-layout-panel-kpis">KPIs</button>
              </li>
            </ul>

            <div id="settings-layout-panel-tables" class="settings-layout-panel active" role="tabpanel" aria-labelledby="settings-layout-tab-tables">
              <p class="text-secondary mb-3">Configure table pagination, sticky column sizing, and layout across pages. Adding new tables to pages is coming later.</p>
              <div id="settings-layout-tables-root" class="dm-root">
                <div class="dm-loading">Loading tables…</div>
              </div>
              <div class="mt-3 d-flex align-items-center gap-2 flex-wrap">
                <button type="button" class="btn btn-primary" id="settings-layout-tables-save-btn">Save</button>
                <button type="button" class="btn btn-outline-secondary" id="settings-layout-tables-reset-btn">Reset to defaults</button>
                <span id="settings-layout-tables-msg" class="form-hint"></span>
              </div>
            </div>

            <div id="settings-layout-panel-charts" class="settings-layout-panel" role="tabpanel" aria-labelledby="settings-layout-tab-charts">
              <p class="text-secondary mb-3">Control chart types, colors, and visibility across the app. These settings are global (shared across all users).</p>
              <div id="settings-charts-root" class="dm-root">
                <div class="dm-loading">Loading charts…</div>
              </div>
              <div class="mt-3 d-flex align-items-center gap-2 flex-wrap">
                <button type="button" class="btn btn-primary" id="settings-charts-save-btn">Save</button>
                <button type="button" class="btn btn-outline-secondary" id="settings-charts-reset-btn">Reset to defaults</button>
                <span id="settings-charts-msg" class="form-hint"></span>
              </div>
              <div class="text-muted small mt-2">Disabling a chart hides the entire card (header + content).</div>
            </div>

            <div id="settings-layout-panel-kpis" class="settings-layout-panel" role="tabpanel" aria-labelledby="settings-layout-tab-kpis">
              <div class="row g-3">
                <div class="col-12">
                  <h4 class="mb-2">KPIs</h4>
                  <p class="text-secondary mb-3">Configure labels and visibility for the dashboard KPI cards and the header KPI chips. Dashboard KPI placement is automatic by enabled order.</p>

                  <div class="card card-sm mb-3">
                    <div class="card-body">
                      <div class="row g-3">
                        <div class="col-12 col-md-6 col-lg-4">
                          <label class="form-label mb-1">Header</label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-delta" />
                            <span class="form-check-label">Show % change</span>
                          </label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-progress" />
                            <span class="form-check-label">Show progress bars</span>
                          </label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-sparkline" />
                            <span class="form-check-label">Show sparklines</span>
                          </label>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                          <label class="form-label mb-1">Dashboard</label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-dashboard-delta" />
                            <span class="form-check-label">Show % change badges</span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="card card-sm mb-3">
                    <div class="card-body">
                      <label class="form-label mb-2">Dashboard KPI placement preview</label>
                      <div id="settings-kpis-placement-preview" class="row g-2">
                        <div class="col-12"><div class="text-muted small">Loading preview…</div></div>
                      </div>
                    </div>
                  </div>

                  <div class="card card-sm mb-3">
                    <div class="card-body">
                      <label class="form-label mb-2">Header KPI strip: show on pages</label>
                      <div class="row g-2">
                        <div class="col-12 col-md-6 col-lg-4">
                          <div class="text-muted small mb-1">Dashboard</div>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="dashboard" />
                            <span class="form-check-label">Overview</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="live" />
                            <span class="form-check-label">Live View</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="sales" />
                            <span class="form-check-label">Recent Sales</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="date" />
                            <span class="form-check-label">Table View</span>
                          </label>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                          <div class="text-muted small mb-1">Insights</div>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="countries" />
                            <span class="form-check-label">Countries</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="products" />
                            <span class="form-check-label">Products</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="variants" />
                            <span class="form-check-label">Variants</span>
                          </label>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                        <div class="text-muted small mb-1">Acquisition + tools</div>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="attribution" />
                            <span class="form-check-label">Acquisition · Attribution</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="devices" />
                            <span class="form-check-label">Acquisition · Devices</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="ads" />
                            <span class="form-check-label">Integrations · Google Ads</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="compare-conversion-rate" />
                            <span class="form-check-label">Tools · Conversion Rate Compare</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="shipping-cr" />
                            <span class="form-check-label">Tools · Shipping CR</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="settings" />
                            <span class="form-check-label">Settings</span>
                          </label>
                        </div>
                      </div>
                      <div class="text-muted small mt-2">Controls the entire top KPI strip (not individual KPI chips).</div>
                    </div>
                  </div>

                  <ul class="nav nav-underline mb-3" id="settings-kpis-layout-tabs" role="tablist" aria-label="KPI layout">
                    <li class="nav-item" role="presentation">
                      <button class="nav-link active" type="button" role="tab" id="settings-kpis-layout-tab-dashboard" data-settings-kpis-layout-tab="dashboard" aria-selected="true" aria-controls="settings-kpis-layout-panel-dashboard">Dashboard</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" type="button" role="tab" id="settings-kpis-layout-tab-header" data-settings-kpis-layout-tab="header" aria-selected="false" aria-controls="settings-kpis-layout-panel-header">Header</button>
                    </li>
                  </ul>

                  <div id="settings-kpis-layout-panel-dashboard" class="settings-kpis-layout-panel active" role="tabpanel" aria-labelledby="settings-kpis-layout-tab-dashboard">
                    <div id="settings-kpis-dashboard-root" class="dm-root">
                      <div class="dm-loading">Loading KPIs…</div>
                    </div>
                  </div>
                  <div id="settings-kpis-layout-panel-header" class="settings-kpis-layout-panel" role="tabpanel" aria-labelledby="settings-kpis-layout-tab-header">
                    <div id="settings-kpis-header-root" class="dm-root">
                      <div class="dm-loading">Loading KPIs…</div>
                    </div>
                  </div>
                </div>

                <div class="col-12">
                  <hr class="my-4" />
                  <h4 class="mb-2">Date Ranges</h4>
                  <p class="text-secondary mb-3">Configure which date ranges are available in the date dropdown.</p>
                  <div id="settings-date-ranges-root" class="dm-root">
                    <div class="dm-loading">Loading date ranges…</div>
                  </div>
                </div>

                <div class="col-12 d-flex align-items-center gap-2 flex-wrap">
                  <button type="button" class="btn btn-primary" id="settings-kpis-save-btn">Save</button>
                  <button type="button" class="btn btn-outline-secondary" id="settings-kpis-reset-btn">Reset to defaults</button>
                  <span id="settings-kpis-msg" class="form-hint"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- KEXO_ADMIN_PANEL_START -->
      <div id="settings-panel-admin" class="settings-panel kexo-admin-only d-none" role="tabpanel" aria-labelledby="settings-tab-admin">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-user-gear me-2" data-icon-key="settings-tab-admin" aria-hidden="true"></i>Admin</h3>
          </div>
          <div class="card-body" id="settings-admin-root">
            <p class="text-secondary small mb-3">Admin controls apply globally. Admin is always loader-disabled.</p>
            <ul class="nav nav-underline mb-3" id="settings-admin-tabs" role="tablist" aria-label="Admin">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" id="settings-admin-tab-controls" data-admin-tab="controls" aria-selected="true" aria-controls="admin-panel-controls">Controls</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-admin-tab-diagnostics" data-admin-tab="diagnostics" aria-selected="false" aria-controls="admin-panel-diagnostics">Diagnostics</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-admin-tab-users" data-admin-tab="users" aria-selected="false" aria-controls="admin-panel-users">Users</button>
              </li>
            </ul>

            <div id="admin-panel-controls" class="admin-panel active" role="tabpanel" aria-labelledby="settings-admin-tab-controls">
              <div class="accordion settings-layout-accordion" id="settings-admin-controls-accordion">
                <div class="accordion-item">
                  <h4 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-preview" aria-expanded="false" aria-controls="settings-admin-accordion-preview"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Preview</span></span></button>
                  </h4>
                  <div id="settings-admin-accordion-preview" class="accordion-collapse collapse" data-bs-parent="#settings-admin-controls-accordion">
                    <div class="accordion-body">
                      <div class="text-secondary small mb-2">Preview affects UI only; server access remains your real account.</div>
                      <div class="row g-3 align-items-end">
                        <div class="col-12 col-lg-6">
                          <label class="form-label" for="admin-preview-tier">Preview as tier</label>
                          <select class="form-select" id="admin-preview-tier" aria-label="Preview as tier">
                            <option value="" selected>Off</option>
                            <option value="starter">Starter</option>
                            <option value="growth">Growth</option>
                            <option value="scale">Scale</option>
                            <option value="max">Max</option>
                            <option value="admin">Admin</option>
                          </select>
                        </div>
                        <div class="col-12 col-lg-6 d-flex gap-2">
                          <button type="button" class="btn btn-outline-secondary" id="admin-preview-exit-btn">Exit preview</button>
                        </div>
                      </div>
                      <div class="form-hint mt-2" id="admin-preview-msg"></div>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h4 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-loader" aria-expanded="false" aria-controls="settings-admin-accordion-loader"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Loader</span></span></button>
                  </h4>
                  <div id="settings-admin-accordion-loader" class="accordion-collapse collapse" data-bs-parent="#settings-admin-controls-accordion">
                    <div class="accordion-body">
                      <div class="text-secondary small mb-2">Enable or disable the page loader overlay per page.</div>
                      <div id="admin-loader-toggles" class="d-grid gap-2">
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-dashboard" data-admin-loader-page="dashboard" />
                          <label class="form-check-label" for="admin-loader-dashboard">Enable loader on Overview</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-live" data-admin-loader-page="live" />
                          <label class="form-check-label" for="admin-loader-live">Enable loader on Live View</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-sales" data-admin-loader-page="sales" />
                          <label class="form-check-label" for="admin-loader-sales">Enable loader on Recent Sales</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-date" data-admin-loader-page="date" />
                          <label class="form-check-label" for="admin-loader-date">Enable loader on Table View</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-countries" data-admin-loader-page="countries" />
                          <label class="form-check-label" for="admin-loader-countries">Enable loader on Countries</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-products" data-admin-loader-page="products" />
                          <label class="form-check-label" for="admin-loader-products">Enable loader on Products</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-variants" data-admin-loader-page="variants" />
                          <label class="form-check-label" for="admin-loader-variants">Enable loader on Variants</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-abandoned-carts" data-admin-loader-page="abandoned-carts" />
                          <label class="form-check-label" for="admin-loader-abandoned-carts">Enable loader on Abandoned Carts</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-channels" data-admin-loader-page="channels" />
                          <label class="form-check-label" for="admin-loader-channels">Enable loader on Channels</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-type" data-admin-loader-page="type" />
                          <label class="form-check-label" for="admin-loader-type">Enable loader on Device &amp; Platform</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-ads" data-admin-loader-page="ads" />
                          <label class="form-check-label" for="admin-loader-ads">Enable loader on Google Ads</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-compare-conversion-rate" data-admin-loader-page="compare-conversion-rate" />
                          <label class="form-check-label" for="admin-loader-compare-conversion-rate">Enable loader on Compare Conversion Rate</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-shipping-cr" data-admin-loader-page="shipping-cr" />
                          <label class="form-check-label" for="admin-loader-shipping-cr">Enable loader on Shipping CR</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-settings" data-admin-loader-page="settings" disabled />
                          <label class="form-check-label" for="admin-loader-settings">Settings loader locked off</label>
                        </div>
                      </div>
                      <div class="form-hint mt-2">Admin loader is always disabled.</div>
                      <div class="form-hint mt-1" id="admin-loader-msg"></div>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h4 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-reporting" aria-expanded="false" aria-controls="settings-admin-accordion-reporting"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Data &amp; Reporting</span></span></button>
                  </h4>
                  <div id="settings-admin-accordion-reporting" class="accordion-collapse collapse" data-bs-parent="#settings-admin-controls-accordion">
                    <div class="accordion-body">
                      <div class="text-secondary small mb-3">Orders source, sessions source, and pixel session mode. Auto-saves on change.</div>
                      <div class="row g-3">
                        <div class="col-12 col-lg-6">
                          <label class="form-label" for="admin-orders-source">Orders source</label>
                          <select class="form-select" id="admin-orders-source">
                            <option value="orders_shopify">orders_shopify</option>
                          </select>
                        </div>
                        <div class="col-12 col-lg-6">
                          <label class="form-label" for="admin-sessions-source">Sessions source</label>
                          <select class="form-select" id="admin-sessions-source">
                            <option value="sessions">sessions</option>
                            <option value="shopify_sessions">shopify_sessions</option>
                          </select>
                        </div>
                        <div class="col-12">
                          <label class="form-label">Pixel session mode</label>
                          <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="admin-pixel-session-mode" />
                            <label class="form-check-label" for="admin-pixel-session-mode">Share session across tabs (30m inactivity)</label>
                          </div>
                        </div>
                      </div>
                      <div class="form-hint mt-2" id="admin-reporting-msg"></div>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h4 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-scope" aria-expanded="false" aria-controls="settings-admin-accordion-scope"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Settings scope</span></span></button>
                  </h4>
                  <div id="settings-admin-accordion-scope" class="accordion-collapse collapse" data-bs-parent="#settings-admin-controls-accordion">
                    <div class="accordion-body">
                      <div class="text-secondary small mb-3">All settings currently apply globally (shared). Per-user settings are coming later.</div>
                      <div class="form-selectgroup" role="group" aria-label="Settings scope">
                        <label class="form-selectgroup-item flex-fill">
                          <input type="radio" name="admin-settings-scope-mode" value="global" class="form-selectgroup-input" id="admin-settings-scope-global" checked disabled>
                          <div class="form-selectgroup-label d-flex align-items-center justify-content-center p-2">
                            <span class="form-selectgroup-label-content">Global (shared)</span>
                          </div>
                        </label>
                        <label class="form-selectgroup-item flex-fill">
                          <input type="radio" name="admin-settings-scope-mode" value="user" class="form-selectgroup-input" id="admin-settings-scope-user" disabled>
                          <div class="form-selectgroup-label d-flex align-items-center justify-content-center p-2">
                            <span class="form-selectgroup-label-content">User-selected</span>
                          </div>
                        </label>
                      </div>
                      <div class="text-secondary small mt-2">User-selected scope is disabled for now.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div id="admin-panel-diagnostics" class="admin-panel" role="tabpanel" aria-labelledby="settings-admin-tab-diagnostics">
              <div class="card">
                <div class="card-header d-flex align-items-center justify-content-between flex-wrap gap-2">
                  <h3 class="card-title mb-0"><i class="fa-thin fa-chart-line me-2" data-icon-key="admin-tab-diagnostics" aria-hidden="true"></i>Diagnostics</h3>
                  <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end">
                    <div class="d-flex align-items-center gap-2">
                      <span class="text-secondary small">Range</span>
                      <select id="diagnostics-overview-range" class="form-select form-select-sm" aria-label="Diagnostics overview range" style="width:auto; min-width: 140px;">
                        <option value="today" selected>Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="7d">Last 7 days</option>
                        <option value="14d">Last 14 days</option>
                        <option value="30d">Last 30 days</option>
                      </select>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-primary" id="config-refresh-btn" aria-label="Refresh diagnostics">
                      <i class="fa-thin fa-rotate-right" data-icon-key="settings-diagnostics-refresh" aria-hidden="true"></i> Refresh
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="config-reconcile-btn" aria-label="Reconcile sales">
                      <i class="fa-thin fa-sliders" data-icon-key="settings-diagnostics-reconcile" aria-hidden="true"></i> Reconcile
                    </button>
                    <span id="config-action-msg" class="form-hint"></span>
                  </div>
                </div>
                <div class="card-body">
                  <div class="text-secondary small mb-3">
                    <strong>Refresh</strong> re-reads diagnostics only. <strong>Reconcile</strong> runs a manual Shopify truth sync for the last 7 days, then refreshes diagnostics.
                  </div>
                  <div id="diagnostics-content">
                    <div class="d-flex align-items-center gap-2 text-secondary">
                      <div class="spinner-border spinner-border-sm text-primary" role="status" aria-hidden="true"></div>
                      <div>Loading diagnostics…</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div id="admin-panel-users" class="admin-panel" role="tabpanel" aria-labelledby="settings-admin-tab-users">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title"><i class="fa-thin fa-users me-2" data-icon-key="admin-tab-users" aria-hidden="true"></i>Users</h3>
                </div>
                <div class="card-body">
                  <div class="text-secondary small mb-3">Pending accounts are blocked everywhere until approved.</div>
                  <ul class="nav nav-underline mb-3" id="settings-admin-users-tabs" role="tablist" aria-label="Users">
                    <li class="nav-item" role="presentation">
                      <button class="nav-link active" type="button" role="tab" id="settings-admin-users-tab-active" data-admin-users-tab="active" aria-selected="true" aria-controls="admin-users-active">Active</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" type="button" role="tab" id="settings-admin-users-tab-pending" data-admin-users-tab="pending" aria-selected="false" aria-controls="admin-users-pending">Pending</button>
                    </li>
                  </ul>
                  <div id="admin-users-active" class="admin-users-pane active" role="tabpanel" aria-labelledby="settings-admin-users-tab-active">
                    <div class="table-responsive">
                      <table class="table table-vcenter card-table table-sm admin-users-table">
                        <thead>
                          <tr>
                            <th>Email</th>
                            <th>Country</th>
                            <th>City</th>
                            <th>Device</th>
                            <th>Last login</th>
                            <th class="text-end">Actions</th>
                          </tr>
                        </thead>
                        <tbody id="admin-users-active-body">
                          <tr><td colspan="6" class="text-secondary">Loading…</td></tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div id="admin-users-pending" class="admin-users-pane" role="tabpanel" aria-labelledby="settings-admin-users-tab-pending">
                    <div class="table-responsive">
                      <table class="table table-vcenter card-table table-sm admin-users-table">
                        <thead>
                          <tr>
                            <th>Email</th>
                            <th>Country</th>
                            <th>City</th>
                            <th>Device</th>
                            <th>Registered</th>
                            <th class="text-end">Actions</th>
                          </tr>
                        </thead>
                        <tbody id="admin-users-pending-body">
                          <tr><td colspan="6" class="text-secondary">Loading…</td></tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- KEXO_ADMIN_PANEL_END -->

    </div>
  </div>

  <!--#include partials/page-body-end.html-->
  <!--#include partials/footer.html-->
  <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/js/tabler.min.js"></script>
  <script src="/kexo-table-builder.js"></script>
  <script src="/kexo-table-defs.js"></script>
  <script src="/kexo-chart-defs.js"></script>
  <script src="/kexo-chart-builder.js"></script>
  <script src="/app.js"></script>
  <script src="/kexo-tooltips.js"></script>
  <script src="/theme-settings.js" defer></script>
  <script src="/attribution-mapping-settings.js"></script>
  <script src="/attribution-tree-settings.js"></script>
  <script src="/settings-page.js"></script>
  <!-- KEXO_ADMIN_SCRIPT_START -->
  <script src="/admin-page.js"></script>
  <!-- KEXO_ADMIN_SCRIPT_END -->
</body>
</html>
