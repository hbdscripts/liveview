<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!--#include partials/head-theme.html-->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon" type="image/webp" href="/assets/logos/new/kexo.webp" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler-flags.min.css" />
  <link rel="stylesheet" href="/tabler-theme.css" />
  <link rel="stylesheet" href="/custom.css" />
  <link rel="stylesheet" href="/diagnostics-modal.css" />
  <title>Kexo · Settings</title>
  <style>
    .settings-panel { display: none; }
    .settings-panel.active { display: block; }
    .list-group.list-group-transparent .list-group-item.active:hover { text-decoration: none !important; }
    .settings-integrations-panel { display: none; }
    .settings-integrations-panel.active { display: block; }
    .settings-kpis-layout-panel { display: none; }
    .settings-kpis-layout-panel.active { display: block; }
    .settings-kexo-panel { display: none; }
    .settings-kexo-panel.active { display: block; }
    .settings-insights-layout-panel { display: none; }
    .settings-insights-layout-panel.active { display: block; }
      .settings-layout-panel { display: none; }
      .settings-layout-panel.active { display: block; }
    .settings-charts-accordion .accordion-item + .settings-charts-group-label { margin-top: 1rem; }
    .settings-charts-group-label { font-size: .74rem; letter-spacing: .06em; text-transform: uppercase; color: var(--tblr-secondary, #66758c); margin: .35rem 0 .45rem; }
    .settings-charts-card-body { padding: .25rem 0; }
    .settings-charts-color-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: .55rem; }
    .settings-charts-color-field-row { display: flex; align-items: center; gap: .5rem; }
    .settings-charts-color-swatch { width: 30px; height: 30px; border-radius: .45rem; border: 1px solid var(--tblr-border-color, #e6e7e9); flex-shrink: 0; }
    .settings-charts-preview-wrap { border: 1px dashed var(--tblr-border-color, #e6e7e9); border-radius: .55rem; padding: .75rem; background: var(--tblr-bg-surface-secondary, #f7f9fc); }
    .settings-charts-preview-canvas { width: 100%; min-height: 150px; }
    .settings-kpi-preview-card { border: 1px solid var(--tblr-border-color, #e6e7e9); border-radius: .5rem; background: #fff; padding: .75rem; }
    .settings-kpi-preview-head { display: flex; align-items: center; justify-content: space-between; gap: .5rem; margin-bottom: .35rem; }
    .settings-kpi-preview-title { font-size: .82rem; color: var(--tblr-secondary, #66758c); }
    .settings-kpi-preview-value { font-size: 1.2rem; font-weight: 700; margin-bottom: .45rem; }
    .settings-kpi-preview-delta { display: inline-flex; align-items: center; gap: .3rem; font-size: 14px; font-weight: 500; color: #2fb344; }
    .settings-layout-accordion .accordion-button { font-size: 16px; }
    .settings-layout-accordion .accordion-button code { font-size: .72rem; }
    .settings-layout-accordion .kexo-settings-accordion-chevron {
      font-size: 14px;
      color: #444;
      flex-shrink: 0;
      display: inline-flex;
      align-items: center;
      margin-right: 0.35rem;
      transition: transform 0.2s ease;
    }
    .settings-layout-accordion .accordion-button:not(.collapsed) .kexo-settings-accordion-chevron {
      transform: rotate(180deg);
    }
    .settings-layout-table-card .card-header { background: var(--tblr-bg-surface-secondary, #f6f8fb); }
    .settings-layout-table-card .card-title { font-size: .95rem; }
    .settings-layout-color-preview {
      width: 100%;
      min-height: 34px;
      border-radius: var(--tblr-border-radius, .375rem);
      border: 1px solid var(--tblr-border-color, #e6e7e9);
    }
    @media (max-width: 768px) {
      .settings-charts-color-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body class="" data-page="settings">
  <!--#include partials/header.html-->
  <!--#include partials/page-body-start.html-->

  <div class="row">
    <!-- Left nav: vertical tabs -->
    <div class="col-lg-3 mb-4 mb-lg-0">
      <div class="list-group list-group-transparent">
        <a href="/settings?tab=kexo" class="list-group-item list-group-item-action d-flex align-items-center active" data-settings-tab="kexo">
          <i class="fa-thin fa-palette me-2" data-icon-key="settings-tab-theme"></i>
          Kexo
        </a>
        <a href="/settings?tab=integrations" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="integrations">
          <i class="fa-thin fa-plug me-2" data-icon-key="settings-tab-integrations"></i>
          Integrations
        </a>
        <a href="/settings?tab=layout" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="layout">
          <i class="fa-thin fa-table-columns me-2" data-icon-key="settings-tab-layout" aria-hidden="true"></i>
          Tables, Charts &amp; KPIs
        </a>
        <a href="/settings?tab=attribution" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="attribution">
          <i class="fa-thin fa-map-location-dot me-2" data-icon-key="settings-tab-sources"></i>
          Attribution
        </a>
        <a href="/settings?tab=insights" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="insights">
          <i class="fa-thin fa-chart-pie me-2" data-icon-key="settings-tab-insights"></i>
          Insights
        </a>
      </div>
    </div>

    <!-- Right content: tab panels -->
    <div class="col-lg-9">
      <div id="settings-panel-kexo" class="settings-panel active">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-palette me-2" data-icon-key="settings-tab-theme" aria-hidden="true"></i>Kexo</h3>
          </div>
          <div class="card-body">
            <ul class="nav nav-underline mb-3" id="settings-kexo-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" data-settings-kexo-tab="general" aria-selected="true">General</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-kexo-tab="icons" aria-selected="false">Icons</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-kexo-tab="header" aria-selected="false">Header</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-kexo-tab="color" aria-selected="false">Color</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-kexo-tab="fonts" aria-selected="false">Fonts</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-kexo-tab="notifications" aria-selected="false">Notifications</button>
              </li>
            </ul>

            <div id="settings-kexo-panel-general" class="settings-kexo-panel active" role="tabpanel">
              <div class="card card-sm mb-3">
                <div class="card-header">
                  <h4 class="card-title"><i class="fa-thin fa-sliders me-2" data-icon-key="settings-tab-general" aria-hidden="true"></i>General</h4>
                </div>
                <div class="card-body">
                  <p class="text-secondary">Read-only environment values plus KPI date label format.</p>
                  <div class="mb-3">
                    <label class="form-label">App URL</label>
                    <input type="text" class="form-control" id="settings-general-app-url" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Admin timezone <span class="badge bg-primary-lt">TODO per-install</span></label>
                    <input type="text" class="form-control" id="settings-general-timezone" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Store domain</label>
                    <input type="text" class="form-control" id="settings-general-shop-domain" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Display domain</label>
                    <input type="text" class="form-control" id="settings-general-display-domain" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Store main URL</label>
                    <input type="text" class="form-control" id="settings-general-store-main" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Ingest URL</label>
                    <input type="text" class="form-control" id="settings-general-ingest-url" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Acquisition mode / DB</label>
                    <input type="text" class="form-control" id="settings-general-traffic-mode" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="settings-general-date-format">KPI date label format</label>
                    <select class="form-select" id="settings-general-date-format">
                      <option value="dmy">English (D/M)</option>
                      <option value="mdy">American (M/D)</option>
                    </select>
                    <div class="form-hint">Controls compact KPI compare labels like <code>16/2 – 16/3</code>.</div>
                  </div>
                  <div class="d-flex align-items-center gap-2 flex-wrap">
                    <button type="button" class="btn btn-primary" id="settings-general-save-btn">Save</button>
                    <span id="settings-general-msg" class="form-hint"></span>
                  </div>
                </div>
              </div>

              <div class="card card-sm">
                <div class="card-header">
                  <h4 class="card-title"><i class="fa-thin fa-image me-2" data-icon-key="settings-tab-assets" aria-hidden="true"></i>Assets</h4>
                </div>
                <div class="card-body">
                  <p class="text-secondary mb-3">Upload/override branding assets (favicon + logos). Saved globally.</p>
                  <form id="settings-assets-form">
                    <div class="row g-3">
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-favicon">Favicon URL override</label>
                        <input type="url" class="form-control" id="settings-asset-favicon" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-favicon" accept="image/png,image/webp,image/jpeg,image/x-icon,image/vnd.microsoft.icon" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="favicon" data-kexo-file="settings-upload-favicon" data-kexo-url="settings-asset-favicon">Upload</button>
                        </div>
                        <div class="form-hint">PNG/ICO recommended.</div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-logo">Header logo URL override</label>
                        <input type="url" class="form-control" id="settings-asset-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-header-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="header_logo" data-kexo-file="settings-upload-header-logo" data-kexo-url="settings-asset-logo">Upload</button>
                        </div>
                        <div class="form-hint">Replaces the top-strip logo across the app.</div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-footer-logo">Footer logo URL override</label>
                        <input type="url" class="form-control" id="settings-asset-footer-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-footer-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="footer_logo" data-kexo-file="settings-upload-footer-logo" data-kexo-url="settings-asset-footer-logo">Upload</button>
                        </div>
                        <div class="form-hint">Replaces the footer center logo.</div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-login-logo">Login logo URL override</label>
                        <input type="url" class="form-control" id="settings-asset-login-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-login-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="login_logo" data-kexo-file="settings-upload-login-logo" data-kexo-url="settings-asset-login-logo">Upload</button>
                        </div>
                        <div class="form-hint">Replaces the logo shown on <code>/app/login</code>.</div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-kexo-fullcolor-logo">Kexo full-color logo URL override</label>
                        <input type="url" class="form-control" id="settings-asset-kexo-fullcolor-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-kexo-fullcolor-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="kexo_logo_fullcolor" data-kexo-file="settings-upload-kexo-fullcolor-logo" data-kexo-url="settings-asset-kexo-fullcolor-logo">Upload</button>
                        </div>
                        <div class="form-hint">Used in Settings → Diagnostics branding blocks.</div>
                      </div>
                    </div>

                    <div class="mt-3">
                      <button type="submit" class="btn btn-primary">Save</button>
                      <span id="settings-assets-msg" class="form-hint ms-2"></span>
                    </div>
                  </form>
                  <p class="text-muted small mt-2 mb-0">Uploads are stored in Cloudflare R2.</p>
                </div>
              </div>
            </div>

            <div id="settings-kexo-panel-ui" class="settings-kexo-panel" role="tabpanel">
              <div class="card card-sm">
                <div class="card-header">
                  <h4 class="card-title" id="settings-theme-title"><i class="fa-thin fa-palette me-2" data-icon-key="settings-tab-theme" aria-hidden="true"></i><span id="settings-theme-title-text">Theme</span></h4>
                </div>
                <div class="card-body" id="settings-theme-panel">
                  <div class="dm-loading">Loading theme…</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-integrations" class="settings-panel">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-plug me-2" data-icon-key="settings-tab-integrations" aria-hidden="true"></i>Integrations</h3>
          </div>
          <div class="card-body">
            <p class="text-secondary mb-3">Shopify + Google Ads integration status and controls.</p>
            <ul class="nav nav-underline mb-3" id="settings-integrations-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" data-settings-integrations-tab="shopify" aria-selected="true">Shopify</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-integrations-tab="googleads" aria-selected="false">Google Ads</button>
              </li>
            </ul>

            <div id="settings-integrations-panel-shopify" class="settings-integrations-panel active" role="tabpanel">
              <div class="row g-3">
                <div class="col-12 col-xl-6">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Shopify Auth</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Shop</strong> <span id="settings-int-shopify-shop" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Token</strong> <span id="settings-int-shopify-token" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Stored scopes</strong> <span id="settings-int-shopify-scopes" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Missing scopes</strong> <span id="settings-int-shopify-missing-scopes" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-xl-6">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Truth Sync</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Sync age</strong> <span id="settings-int-shopify-sync-age" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Last sync</strong> <span id="settings-int-shopify-last-sync" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Last error</strong> <span id="settings-int-shopify-last-error" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Pixel</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Installed</strong> <span id="settings-int-pixel-installed" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Pixel ingestUrl</strong> <span id="settings-int-pixel-ingest" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Expected ingestUrl</strong> <span id="settings-int-expected-ingest" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Ingest URL match</strong> <span id="settings-int-pixel-match" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Session mode</strong> <span id="settings-int-session-mode" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div id="settings-integrations-panel-googleads" class="settings-integrations-panel" role="tabpanel">
              <div class="card card-sm mb-3">
                <div class="card-header"><h4 class="card-title">Google Ads Connection</h4></div>
                <div class="card-body">
                  <div class="mb-2"><strong>Configured</strong> <span id="settings-int-ga-configured" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Connected</strong> <span id="settings-int-ga-connected" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Customer ID</strong> <span id="settings-int-ga-customer-id" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Login Customer ID</strong> <span id="settings-int-ga-login-customer-id" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Developer token</strong> <span id="settings-int-ga-dev-token" class="text-muted">—</span></div>
                  <div class="mb-0"><strong>Refresh token</strong> <span id="settings-int-ga-refresh-token" class="text-muted">—</span></div>
                </div>
              </div>
              <div class="d-flex align-items-center gap-2 flex-wrap mb-2">
                <a class="btn btn-outline-primary btn-sm" id="settings-ga-connect-btn" href="/api/ads/google/connect?redirect=%2Fsettings%3Ftab%3Dintegrations">Connect</a>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-status-btn">Status</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-summary-btn">Summary</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-refresh-7d-btn">Refresh 7d</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-refresh-month-btn">Refresh month</button>
                <span id="settings-ga-msg" class="form-hint"></span>
              </div>
              <pre id="settings-ga-output" class="dm-json-pre mb-0">Loading…</pre>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-attribution" class="settings-panel">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-map-location-dot me-2" data-icon-key="settings-tab-sources" aria-hidden="true"></i>Attribution</h3>
          </div>
          <div class="card-body">
            <p class="text-secondary">Map observed tokens (UTMs, referrer host, entry URL params, explicit <code>kexo_attr</code>) into persisted Attribution variants (Channel + Source + Ownership).</p>
            <div id="settings-attribution-mapping-root" class="dm-root">
              <div class="dm-loading-spinner"><div class="report-build-wrap"><div class="spinner-border text-primary" role="status"></div><div class="report-build-title">loading attribution mapping</div></div></div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-insights" class="settings-panel">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-chart-pie me-2" data-icon-key="settings-tab-insights" aria-hidden="true"></i>Insights</h3>
          </div>
          <div class="card-body">
            <ul class="nav nav-underline mb-3" id="settings-insights-layout-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-insights-layout-tab="products" aria-selected="false">Products</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-insights-layout-tab="countries" aria-selected="false">Countries</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" data-settings-insights-layout-tab="variants" aria-selected="true">Variants</button>
              </li>
            </ul>

            <div id="settings-insights-layout-panel-products" class="settings-insights-layout-panel" role="tabpanel">
              <p class="text-secondary mb-0">Products controls are planned for a future update.</p>
            </div>
            <div id="settings-insights-layout-panel-countries" class="settings-insights-layout-panel" role="tabpanel">
              <p class="text-secondary mb-0">Countries controls are planned for a future update.</p>
            </div>
            <div id="settings-insights-layout-panel-variants" class="settings-insights-layout-panel active" role="tabpanel">
              <p class="text-secondary mb-3">Create and manage custom variant mapping tables used by Insights → Variants.</p>
              <div id="settings-insights-variants-root" class="dm-root">
                <div class="dm-loading">Loading variant table mappings…</div>
              </div>
              <div class="mt-3 d-flex align-items-center justify-content-between flex-wrap gap-2">
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <button type="button" class="btn btn-outline-primary" id="settings-insights-variants-suggest-btn">Suggest mappings</button>
                  <button type="button" class="btn btn-outline-danger" id="settings-insights-variants-warnings-btn" disabled>Warnings</button>
                  <button type="button" class="btn btn-outline-primary" id="settings-insights-variants-ignore-btn">Ignored List</button>
                  <button type="button" class="btn btn-outline-primary is-hidden" id="settings-insights-variants-reset-variants-btn">Reset Variants</button>
                </div>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <button type="button" class="btn btn-success" id="settings-insights-variants-save-btn">Save</button>
                </div>
              </div>
              <div class="mt-2"><span id="settings-insights-variants-msg" class="form-hint"></span></div>
              <div class="text-muted small mt-2">Save is allowed even when enabled tables have unmapped in-scope variants. You\u2019ll see warnings to help improve coverage. Overlap is auto-managed by specificity/order, and out-of-scope titles are skipped.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-ignore-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Ignored Variant Titles</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-ignore></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-ignore-body">
              <div class="text-secondary">Loading ignored titles…</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-ignore-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-ignore>Close</button>
                <button type="button" class="btn btn-primary" id="settings-insights-variants-ignore-save-btn">Save changes</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-suggest-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Variant mapping suggestions</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-suggest></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-suggest-body">
              <div class="text-secondary">Loading suggestions…</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-suggest-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-suggest>Close</button>
                <button type="button" class="btn btn-outline-secondary" id="settings-insights-variants-suggest-refresh-btn">Refresh from Shopify</button>
                <button type="button" class="btn btn-primary" id="settings-insights-variants-suggest-apply-btn">Apply selected</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-merge-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Merge variant labels</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-merge></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-merge-body">
              <div class="text-secondary">Loading…</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-merge-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-merge>Cancel</button>
                <button type="button" class="btn btn-primary" id="settings-insights-variants-merge-apply-btn">Merge</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-warnings-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Variants mapping warnings</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-warnings></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-warnings-body">
              <div class="text-secondary">No warnings loaded yet.</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-warnings-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-warnings>Close</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-layout" class="settings-panel">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fa-thin fa-table-columns me-2" data-icon-key="settings-tab-layout" aria-hidden="true"></i>Tables, Charts &amp; KPIs</h3>
          </div>
          <div class="card-body">
            <ul class="nav nav-underline mb-3" id="settings-layout-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" data-settings-layout-tab="tables" aria-selected="true">Tables</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-layout-tab="charts" aria-selected="false">Charts</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-layout-tab="kpis" aria-selected="false">KPIs</button>
              </li>
            </ul>

            <div id="settings-layout-panel-tables" class="settings-layout-panel active" role="tabpanel">
              <p class="text-secondary mb-3">Configure table pagination, sticky column sizing, and layout across pages. Adding new tables to pages is coming later.</p>
              <div id="settings-layout-tables-root" class="dm-root">
                <div class="dm-loading">Loading tables…</div>
              </div>
              <div class="mt-3 d-flex align-items-center gap-2 flex-wrap">
                <button type="button" class="btn btn-primary" id="settings-layout-tables-save-btn">Save</button>
                <button type="button" class="btn btn-outline-secondary" id="settings-layout-tables-reset-btn">Reset to defaults</button>
                <span id="settings-layout-tables-msg" class="form-hint"></span>
              </div>
            </div>

            <div id="settings-layout-panel-charts" class="settings-layout-panel" role="tabpanel">
              <p class="text-secondary mb-3">Control chart types, colors, and visibility across the app. These settings are global (shared across all users).</p>
              <div id="settings-charts-root" class="dm-root">
                <div class="dm-loading">Loading charts…</div>
              </div>
              <div class="mt-3 d-flex align-items-center gap-2 flex-wrap">
                <button type="button" class="btn btn-primary" id="settings-charts-save-btn">Save</button>
                <button type="button" class="btn btn-outline-secondary" id="settings-charts-reset-btn">Reset to defaults</button>
                <span id="settings-charts-msg" class="form-hint"></span>
              </div>
              <div class="text-muted small mt-2">Disabling a chart hides the entire card (header + content).</div>
            </div>

            <div id="settings-layout-panel-kpis" class="settings-layout-panel" role="tabpanel">
              <div class="row g-3">
                <div class="col-12">
                  <h4 class="mb-2">KPIs</h4>
                  <p class="text-secondary mb-3">Configure labels and visibility for the dashboard KPI cards and the header KPI chips. Dashboard KPI placement is automatic by enabled order.</p>

                  <div class="card card-sm mb-3">
                    <div class="card-body">
                      <div class="row g-3">
                        <div class="col-12 col-md-6 col-lg-4">
                          <label class="form-label mb-1">Header</label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-delta" />
                            <span class="form-check-label">Show % change</span>
                          </label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-progress" />
                            <span class="form-check-label">Show progress bars</span>
                          </label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-sparkline" />
                            <span class="form-check-label">Show sparklines</span>
                          </label>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                          <label class="form-label mb-1">Dashboard</label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-dashboard-delta" />
                            <span class="form-check-label">Show % change badges</span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="card card-sm mb-3">
                    <div class="card-body">
                      <label class="form-label mb-2">Dashboard KPI placement preview</label>
                      <div id="settings-kpis-placement-preview" class="row g-2">
                        <div class="col-12"><div class="text-muted small">Loading preview…</div></div>
                      </div>
                    </div>
                  </div>

                  <div class="card card-sm mb-3">
                    <div class="card-body">
                      <label class="form-label mb-2">Header KPI strip: show on pages</label>
                      <div class="row g-2">
                        <div class="col-12 col-md-6 col-lg-4">
                          <div class="text-muted small mb-1">Dashboard</div>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="dashboard" />
                            <span class="form-check-label">Overview</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="live" />
                            <span class="form-check-label">Live View</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="sales" />
                            <span class="form-check-label">Recent Sales</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="date" />
                            <span class="form-check-label">Table View</span>
                          </label>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                          <div class="text-muted small mb-1">Insights</div>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="countries" />
                            <span class="form-check-label">Countries</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="products" />
                            <span class="form-check-label">Products</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="variants" />
                            <span class="form-check-label">Variants</span>
                          </label>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                        <div class="text-muted small mb-1">Acquisition + tools</div>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="attribution" />
                            <span class="form-check-label">Acquisition · Attribution</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="devices" />
                            <span class="form-check-label">Acquisition · Devices</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="ads" />
                            <span class="form-check-label">Integrations · Google Ads</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="compare-conversion-rate" />
                            <span class="form-check-label">Tools · Conversion Rate Compare</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="shipping-cr" />
                            <span class="form-check-label">Tools · Shipping CR</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="settings" />
                            <span class="form-check-label">Settings</span>
                          </label>
                        </div>
                      </div>
                      <div class="text-muted small mt-2">Controls the entire top KPI strip (not individual KPI chips).</div>
                    </div>
                  </div>

                  <ul class="nav nav-underline mb-3" id="settings-kpis-layout-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                      <button class="nav-link active" type="button" role="tab" data-settings-kpis-layout-tab="dashboard" aria-selected="true">Dashboard</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" type="button" role="tab" data-settings-kpis-layout-tab="header" aria-selected="false">Header</button>
                    </li>
                  </ul>

                  <div id="settings-kpis-layout-panel-dashboard" class="settings-kpis-layout-panel active" role="tabpanel">
                    <div id="settings-kpis-dashboard-root" class="dm-root">
                      <div class="dm-loading">Loading KPIs…</div>
                    </div>
                  </div>
                  <div id="settings-kpis-layout-panel-header" class="settings-kpis-layout-panel" role="tabpanel">
                    <div id="settings-kpis-header-root" class="dm-root">
                      <div class="dm-loading">Loading KPIs…</div>
                    </div>
                  </div>
                </div>

                <div class="col-12">
                  <hr class="my-4" />
                  <h4 class="mb-2">Date Ranges</h4>
                  <p class="text-secondary mb-3">Configure which date ranges are available in the date dropdown.</p>
                  <div id="settings-date-ranges-root" class="dm-root">
                    <div class="dm-loading">Loading date ranges…</div>
                  </div>
                </div>

                <div class="col-12 d-flex align-items-center gap-2 flex-wrap">
                  <button type="button" class="btn btn-primary" id="settings-kpis-save-btn">Save</button>
                  <button type="button" class="btn btn-outline-secondary" id="settings-kpis-reset-btn">Reset to defaults</button>
                  <span id="settings-kpis-msg" class="form-hint"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!--#include partials/page-body-end.html-->
  <!--#include partials/footer.html-->
  <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/js/tabler.min.js"></script>
  <script src="/kexo-table-builder.js"></script>
  <script src="/kexo-table-defs.js"></script>
  <script src="/kexo-chart-defs.js"></script>
  <script src="/kexo-chart-builder.js"></script>
  <script src="/app.js"></script>
  <script src="/theme-settings.js" defer></script>
  <script src="/attribution-mapping-settings.js"></script>
  <script src="/settings-page.js"></script>
</body>
</html>
