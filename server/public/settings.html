<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!--#include partials/head-theme.html-->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler-flags.min.css" />
  <link rel="stylesheet" href="/tabler-theme.css" />
  <link rel="stylesheet" href="/custom.css" />
  <link rel="stylesheet" href="/diagnostics-modal.css" />
  <title>Kexo · Settings</title>
  <style>
    .settings-panel { display: none; }
    .settings-panel.active { display: block; }
    .settings-integrations-panel { display: none; }
    .settings-integrations-panel.active { display: block; }
    .settings-kpis-layout-panel { display: none; }
    .settings-kpis-layout-panel.active { display: block; }
  </style>
</head>
<body class="" data-page="settings">
  <!--#include partials/header.html-->
  <!--#include partials/page-body-start.html-->

  <div class="page-header mb-3">
    <div class="row align-items-center">
      <div class="col">
        <div class="page-pretitle">Administration</div>
        <h2 class="page-title">Settings</h2>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Left nav: vertical tabs -->
    <div class="col-lg-3 mb-4 mb-lg-0">
      <div class="list-group list-group-transparent">
        <a href="/settings?tab=general" class="list-group-item list-group-item-action d-flex align-items-center active" data-settings-tab="general">
          <i class="fa-solid fa-sliders me-2" data-icon-key="settings-tab-general"></i>
          General
        </a>
        <a href="/settings?tab=theme" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="theme">
          <i class="fa-solid fa-palette me-2" data-icon-key="settings-tab-theme"></i>
          Theme
        </a>
        <a href="/settings?tab=assets" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="assets">
          <i class="fa-solid fa-image me-2" data-icon-key="settings-tab-assets"></i>
          Assets
        </a>
        <a href="/settings?tab=data-reporting" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="data-reporting">
          <i class="fa-solid fa-chart-column me-2" data-icon-key="settings-tab-data-reporting"></i>
          Data &amp; Reporting
        </a>
        <a href="/settings?tab=integrations" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="integrations">
          <i class="fa-solid fa-plug me-2" data-icon-key="settings-tab-integrations"></i>
          Integrations
        </a>
        <a href="/settings?tab=sources" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="sources">
          <i class="fa-solid fa-map-location-dot me-2" data-icon-key="settings-tab-sources"></i>
          Sources
        </a>
        <a href="/settings?tab=kpis" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="kpis">
          <i class="fa-solid fa-gauge-high me-2" data-icon-key="settings-tab-kpis"></i>
          KPIs &amp; Date Ranges
        </a>
        <a href="/settings?tab=diagnostics" class="list-group-item list-group-item-action d-flex align-items-center" data-settings-tab="diagnostics">
          <i class="fa-solid fa-chart-line me-2" data-icon-key="settings-tab-diagnostics"></i>
          Diagnostics
        </a>
      </div>
    </div>

    <!-- Right content: tab panels -->
    <div class="col-lg-9">
      <div id="settings-panel-general" class="settings-panel active">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">General</h3>
          </div>
          <div class="card-body">
            <p class="text-secondary">Read-only environment values.</p>
            <div class="mb-3">
              <label class="form-label">App URL</label>
              <input type="text" class="form-control" id="settings-general-app-url" value="—" readonly />
            </div>
            <div class="mb-3">
              <label class="form-label">Admin timezone <span class="badge bg-primary-lt">TODO per-install</span></label>
              <input type="text" class="form-control" id="settings-general-timezone" value="—" readonly />
            </div>
            <div class="mb-3">
              <label class="form-label">Store domain</label>
              <input type="text" class="form-control" id="settings-general-shop-domain" value="—" readonly />
            </div>
            <div class="mb-3">
              <label class="form-label">Display domain</label>
              <input type="text" class="form-control" id="settings-general-display-domain" value="—" readonly />
            </div>
            <div class="mb-3">
              <label class="form-label">Store main URL</label>
              <input type="text" class="form-control" id="settings-general-store-main" value="—" readonly />
            </div>
            <div class="mb-3">
              <label class="form-label">Ingest URL</label>
              <input type="text" class="form-control" id="settings-general-ingest-url" value="—" readonly />
            </div>
            <div class="mb-3">
              <label class="form-label">Traffic mode / DB</label>
              <input type="text" class="form-control" id="settings-general-traffic-mode" value="—" readonly />
            </div>
          </div>
        </div>
        <div class="card mt-3">
          <div class="card-header">
            <h3 class="card-title">Settings scope</h3>
          </div>
          <div class="card-body">
            <p class="text-secondary mb-3">All Settings currently apply globally to all users. Per-user settings are coming later.</p>
            <div class="form-selectgroup" role="group" aria-label="Settings scope">
              <label class="form-selectgroup-item flex-fill">
                <input type="radio" name="settings-scope-mode" value="global" class="form-selectgroup-input" id="settings-scope-global" checked>
                <div class="form-selectgroup-label d-flex align-items-center justify-content-center p-2">
                  <span class="form-selectgroup-label-content">Global (shared)</span>
                </div>
              </label>
              <label class="form-selectgroup-item flex-fill">
                <input type="radio" name="settings-scope-mode" value="user" class="form-selectgroup-input" id="settings-scope-user" disabled>
                <div class="form-selectgroup-label d-flex align-items-center justify-content-center p-2">
                  <span class="form-selectgroup-label-content">User-selected</span>
                </div>
              </label>
            </div>
            <div class="text-secondary small mt-2">User-selected scope is disabled for now.</div>
          </div>
        </div>
      </div>

      <div id="settings-panel-theme" class="settings-panel">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Theme</h3>
          </div>
          <div class="card-body" id="settings-theme-panel">
            <div class="dm-loading">Loading theme…</div>
          </div>
        </div>
      </div>

      <div id="settings-panel-assets" class="settings-panel">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Assets</h3>
          </div>
          <div class="card-body">
            <p class="text-secondary">Override favicon, logos. URL override only.</p>
            <form id="settings-assets-form">
              <div class="mb-3">
                <label class="form-label" for="settings-asset-favicon">Favicon override URL</label>
                <input type="url" class="form-control" id="settings-asset-favicon" placeholder="https://…" />
              </div>
              <div class="mb-3">
                <label class="form-label" for="settings-asset-logo">Logo override URL</label>
                <input type="url" class="form-control" id="settings-asset-logo" placeholder="https://…" />
              </div>
              <button type="submit" class="btn btn-primary">Save</button>
              <span id="settings-assets-msg" class="form-hint ms-2"></span>
            </form>
            <p class="text-muted small mt-2">Upload: <span class="badge bg-primary-lt">TODO</span></p>
          </div>
        </div>
      </div>

      <div id="settings-panel-data-reporting" class="settings-panel">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Data &amp; Reporting</h3>
          </div>
          <div class="card-body">
            <p class="text-secondary">Orders source, sessions source, pixel session mode. Auto-saves on change.</p>
            <div class="mb-3">
              <label class="form-label" for="settings-orders-source">Orders source</label>
              <select class="form-select" id="settings-orders-source">
                <option value="orders_shopify">orders_shopify</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label" for="settings-sessions-source">Sessions source</label>
              <select class="form-select" id="settings-sessions-source">
                <option value="sessions">sessions</option>
                <option value="shopify_sessions">shopify_sessions</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Pixel session mode</label>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="settings-pixel-session-mode" />
                <label class="form-check-label" for="settings-pixel-session-mode">Share session across tabs (30m inactivity)</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-integrations" class="settings-panel">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Integrations</h3>
          </div>
          <div class="card-body">
            <p class="text-secondary mb-3">Shopify + Google Ads integration status and controls.</p>
            <ul class="nav nav-underline mb-3" id="settings-integrations-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" data-settings-integrations-tab="shopify" aria-selected="true">Shopify</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" data-settings-integrations-tab="googleads" aria-selected="false">Google Ads</button>
              </li>
            </ul>

            <div id="settings-integrations-panel-shopify" class="settings-integrations-panel active" role="tabpanel">
              <div class="row g-3">
                <div class="col-12 col-xl-6">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Shopify Auth</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Shop</strong> <span id="settings-int-shopify-shop" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Token</strong> <span id="settings-int-shopify-token" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Stored scopes</strong> <span id="settings-int-shopify-scopes" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Missing scopes</strong> <span id="settings-int-shopify-missing-scopes" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-xl-6">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Truth Sync</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Sync age</strong> <span id="settings-int-shopify-sync-age" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Last sync</strong> <span id="settings-int-shopify-last-sync" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Last error</strong> <span id="settings-int-shopify-last-error" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Pixel</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Installed</strong> <span id="settings-int-pixel-installed" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Pixel ingestUrl</strong> <span id="settings-int-pixel-ingest" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Expected ingestUrl</strong> <span id="settings-int-expected-ingest" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Ingest URL match</strong> <span id="settings-int-pixel-match" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Session mode</strong> <span id="settings-int-session-mode" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div id="settings-integrations-panel-googleads" class="settings-integrations-panel" role="tabpanel">
              <div class="card card-sm mb-3">
                <div class="card-header"><h4 class="card-title">Google Ads Connection</h4></div>
                <div class="card-body">
                  <div class="mb-2"><strong>Configured</strong> <span id="settings-int-ga-configured" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Connected</strong> <span id="settings-int-ga-connected" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Customer ID</strong> <span id="settings-int-ga-customer-id" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Login Customer ID</strong> <span id="settings-int-ga-login-customer-id" class="text-muted">—</span></div>
                  <div class="mb-2"><strong>Developer token</strong> <span id="settings-int-ga-dev-token" class="text-muted">—</span></div>
                  <div class="mb-0"><strong>Refresh token</strong> <span id="settings-int-ga-refresh-token" class="text-muted">—</span></div>
                </div>
              </div>
              <div class="d-flex align-items-center gap-2 flex-wrap mb-2">
                <a class="btn btn-outline-primary btn-sm" id="settings-ga-connect-btn" href="/api/ads/google/connect?redirect=%2Fsettings%3Ftab%3Dintegrations">Connect</a>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-status-btn">Status</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-summary-btn">Summary</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-refresh-7d-btn">Refresh 7d</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-refresh-month-btn">Refresh month</button>
                <span id="settings-ga-msg" class="form-hint"></span>
              </div>
              <pre id="settings-ga-output" class="dm-json-pre mb-0">Loading…</pre>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-sources" class="settings-panel">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Traffic Sources</h3>
          </div>
          <div class="card-body">
            <p class="text-secondary">Map UTM parameters and referrers to source labels and icons.</p>
            <div id="settings-traffic-source-mapping-root" class="dm-root">
              <div class="dm-loading-spinner"><div class="report-build-wrap"><div class="spinner-border text-primary" role="status"></div><div class="report-build-title">loading sources</div></div></div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-kpis" class="settings-panel">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">KPIs &amp; Date Ranges</h3>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-12">
                <h4 class="mb-2">KPIs</h4>
                <p class="text-secondary mb-3">Configure labels and visibility for the dashboard KPI cards and the header KPI chips.</p>

                <div class="card card-sm mb-3">
                  <div class="card-body">
                    <div class="row g-3">
                      <div class="col-12 col-md-6 col-lg-4">
                        <label class="form-label mb-1">Header</label>
                        <label class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-delta" />
                          <span class="form-check-label">Show % change</span>
                        </label>
                        <label class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-progress" />
                          <span class="form-check-label">Show progress bars</span>
                        </label>
                        <label class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-sparkline" />
                          <span class="form-check-label">Show sparklines</span>
                        </label>
                      </div>
                      <div class="col-12 col-md-6 col-lg-4">
                        <label class="form-label mb-1">Dashboard</label>
                        <label class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="settings-kpi-opt-dashboard-delta" />
                          <span class="form-check-label">Show % change badges</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>

                <ul class="nav nav-underline mb-3" id="settings-kpis-layout-tabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active" type="button" role="tab" data-settings-kpis-layout-tab="dashboard" aria-selected="true">Dashboard</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" type="button" role="tab" data-settings-kpis-layout-tab="header" aria-selected="false">Header</button>
                  </li>
                </ul>

                <div id="settings-kpis-layout-panel-dashboard" class="settings-kpis-layout-panel active" role="tabpanel">
                  <div id="settings-kpis-dashboard-root" class="dm-root">
                    <div class="dm-loading">Loading KPIs…</div>
                  </div>
                </div>
                <div id="settings-kpis-layout-panel-header" class="settings-kpis-layout-panel" role="tabpanel">
                  <div id="settings-kpis-header-root" class="dm-root">
                    <div class="dm-loading">Loading KPIs…</div>
                  </div>
                </div>
              </div>

              <div class="col-12">
                <hr class="my-4" />
                <h4 class="mb-2">Date Ranges</h4>
                <p class="text-secondary mb-3">Configure which date ranges are available in the date dropdown.</p>
                <div id="settings-date-ranges-root" class="dm-root">
                  <div class="dm-loading">Loading date ranges…</div>
                </div>
              </div>

              <div class="col-12 d-flex align-items-center gap-2 flex-wrap">
                <button type="button" class="btn btn-primary" id="settings-kpis-save-btn">Save</button>
                <button type="button" class="btn btn-outline-secondary" id="settings-kpis-reset-btn">Reset to defaults</button>
                <span id="settings-kpis-msg" class="form-hint"></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-diagnostics" class="settings-panel">
        <div class="card">
          <div class="card-header d-flex align-items-center justify-content-between flex-wrap gap-2">
            <h3 class="card-title mb-0">Diagnostics</h3>
            <div class="d-flex align-items-center gap-1">
              <button type="button" class="btn btn-sm btn-outline-primary" id="config-refresh-btn" aria-label="Refresh diagnostics">
                <i class="fa-solid fa-rotate-right" data-icon-key="settings-diagnostics-refresh" aria-hidden="true"></i> Refresh
              </button>
              <button type="button" class="btn btn-sm btn-outline-secondary" id="config-reconcile-btn" aria-label="Reconcile sales">
                <i class="fa-solid fa-sliders" data-icon-key="settings-diagnostics-reconcile" aria-hidden="true"></i> Reconcile
              </button>
            </div>
          </div>
          <div class="card-body">
            <div id="diagnostics-content" class="dm-root">
              <div class="dm-loading-spinner"><div class="report-build-wrap"><div class="spinner-border text-primary" role="status"></div><div class="report-build-title">building diagnostics</div><div class="report-build-step">&mdash;</div></div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--#include partials/page-body-end.html-->
  <!--#include partials/footer.html-->
  <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/js/tabler.min.js"></script>
  <script src="/app.js"></script>
  <script src="/theme-settings.js" defer></script>
  <script src="/settings-page.js"></script>
</body>
</html>
