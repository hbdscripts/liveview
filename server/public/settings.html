<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!--#include partials/head-theme.html-->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon" type="image/webp" href="/assets/logos/new/kexo.webp" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler-flags.min.css" />
  <link rel="stylesheet" href="/tabler-theme.css" />
  <link rel="stylesheet" href="/custom.css" />
  <link rel="stylesheet" href="/diagnostics-modal.css" />
  <title>Kexo · Settings</title>
</head>
<body class="" data-page="settings">
  <!--#include partials/header.html-->
  <!--#include partials/page-body-start.html-->

  <div class="row">
    <!-- Left nav: category tablist with children -->
    <div class="col-lg-3 mb-4 mb-lg-0 d-none d-lg-block" role="presentation">
      <div class="list-group list-group-transparent" id="settings-category-tablist" role="tablist" aria-label="Settings categories">
        <div class="settings-nav-category">
          <a href="/settings?tab=kexo&kexoTab=general" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-kexo" role="tab" data-settings-tab="kexo" aria-controls="settings-panel-kexo">Kexo</a>
          <div class="settings-nav-children">
            <a href="/settings?tab=kexo&kexoTab=general" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="kexo" data-settings-kexo-tab="general" role="tab" aria-controls="settings-panel-kexo">General</a>
            <a href="/settings?tab=kexo&kexoTab=icons-assets" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="kexo" data-settings-kexo-tab="icons-assets" role="tab" aria-controls="settings-panel-kexo">Icons &amp; assets</a>
            <a href="/settings?tab=kexo&kexoTab=theme-display" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="kexo" data-settings-kexo-tab="theme-display" role="tab" aria-controls="settings-panel-kexo">Theme &amp; display</a>
          </div>
        </div>
        <div class="settings-nav-category">
          <a href="/settings?tab=integrations&integrationsTab=shopify" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-integrations" role="tab" data-settings-tab="integrations" aria-controls="settings-panel-integrations">Integrations</a>
          <div class="settings-nav-children">
            <a href="/settings?tab=integrations&integrationsTab=shopify" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="integrations" data-settings-integrations-tab="shopify" role="tab" aria-controls="settings-panel-integrations">Shopify</a>
            <a href="/settings?tab=integrations&integrationsTab=googleads" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="integrations" data-settings-integrations-tab="googleads" role="tab" aria-controls="settings-panel-integrations">Google Ads</a>
          </div>
        </div>
        <div class="settings-nav-category">
          <a href="/settings?tab=layout&layoutTab=tables" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-layout" role="tab" data-settings-tab="layout" aria-controls="settings-panel-layout">Dashboards &amp; layout</a>
          <div class="settings-nav-children">
            <a href="/settings?tab=layout&layoutTab=tables" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="layout" data-settings-layout-tab="tables" role="tab" aria-controls="settings-panel-layout">Tables</a>
            <a href="/settings?tab=layout&layoutTab=kpis" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="layout" data-settings-layout-tab="kpis" role="tab" aria-controls="settings-panel-layout">KPIs</a>
            <a href="/settings?tab=layout&layoutTab=date-ranges" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="layout" data-settings-layout-tab="date-ranges" role="tab" aria-controls="settings-panel-layout">Date ranges</a>
          </div>
        </div>
        <div class="settings-nav-category">
          <a href="/settings?tab=attribution&attributionTab=mapping" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-attribution" role="tab" data-settings-tab="attribution" aria-controls="settings-panel-attribution">Attribution</a>
          <div class="settings-nav-children">
            <a href="/settings?tab=attribution&attributionTab=mapping" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="attribution" data-settings-attribution-tab="mapping" role="tab" aria-controls="settings-panel-attribution">Mapping rules</a>
            <a href="/settings?tab=attribution&attributionTab=tree" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="attribution" data-settings-attribution-tab="tree" role="tab" aria-controls="settings-panel-attribution">Channel tree</a>
          </div>
        </div>
        <div class="settings-nav-category">
          <a href="/settings?tab=insights" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-insights" role="tab" data-settings-tab="insights" aria-controls="settings-panel-insights">Insights configuration</a>
          <div class="settings-nav-children">
            <a href="/settings?tab=insights" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="insights" role="tab" aria-controls="settings-panel-insights">Variants</a>
          </div>
        </div>
        <!-- KEXO_COST_EXPENSES_NAV_START -->
        <div class="settings-nav-category">
          <a href="/settings?tab=cost-expenses&costExpensesTab=cost-sources" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-cost-expenses" role="tab" data-settings-tab="cost-expenses" aria-controls="settings-panel-cost-expenses">Costs &amp; profit</a>
          <div class="settings-nav-children">
            <a href="/settings?tab=cost-expenses&costExpensesTab=cost-sources" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="cost-expenses" data-settings-cost-expenses-tab="cost-sources" role="tab" aria-controls="settings-panel-cost-expenses">Cost sources</a>
            <a href="/settings?tab=cost-expenses&costExpensesTab=shipping" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="cost-expenses" data-settings-cost-expenses-tab="shipping" role="tab" aria-controls="settings-panel-cost-expenses">Shipping costs</a>
            <a href="/settings?tab=cost-expenses&costExpensesTab=rules" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="cost-expenses" data-settings-cost-expenses-tab="rules" role="tab" aria-controls="settings-panel-cost-expenses">Rules &amp; adjustments</a>
          </div>
        </div>
        <!-- KEXO_COST_EXPENSES_NAV_END -->
        <!-- KEXO_ADMIN_NAV_START -->
        <div class="settings-nav-category kexo-admin-only d-none">
          <a href="/settings?tab=admin&adminTab=users" class="list-group-item list-group-item-action d-flex align-items-center" id="settings-tab-admin" role="tab" data-settings-tab="admin" aria-controls="settings-panel-admin">Admin (admin-only)</a>
          <div class="settings-nav-children">
            <a href="/settings?tab=admin&adminTab=users" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="admin" data-settings-admin-tab="users" role="tab" aria-controls="settings-panel-admin">Users &amp; roles</a>
            <a href="/settings?tab=admin&adminTab=diagnostics" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="admin" data-settings-admin-tab="diagnostics" role="tab" aria-controls="settings-panel-admin">Diagnostics</a>
            <a href="/settings?tab=admin&adminTab=controls" class="list-group-item list-group-item-action settings-nav-child" data-settings-tab="admin" data-settings-admin-tab="controls" role="tab" aria-controls="settings-panel-admin">Controls</a>
          </div>
        </div>
        <!-- KEXO_ADMIN_NAV_END -->
      </div>
    </div>

    <!-- Right content: category tab panels -->
    <div class="col-lg-9">
      <!-- Mobile settings menu trigger (hamburger). Desktop keeps the sidebar. -->
      <div class="d-flex align-items-center gap-2 d-lg-none mb-3 settings-mobile-topbar">
        <button type="button" class="btn btn-outline-primary btn-icon" id="settings-mobile-menu-btn" aria-label="Open settings menu" aria-controls="settings-mobile-drawer" aria-expanded="false">
          <i class="fa-thin fa-bars" aria-hidden="true"></i>
        </button>
        <div class="flex-grow-1 min-w-0">
          <div class="text-secondary small">Settings</div>
          <div class="fw-semibold text-truncate" id="settings-mobile-menu-title">General</div>
        </div>
      </div>

      <div id="settings-panel-kexo" class="settings-panel active" role="tabpanel" aria-labelledby="settings-tab-kexo">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Kexo</h3>
          </div>
          <div class="card-body">
            <div class="accordion settings-layout-accordion" id="settings-kexo-accordion">
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-kexo-accordion-general" aria-expanded="false" aria-controls="settings-kexo-accordion-general"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">General</span></span></button>
                </h4>
                <div id="settings-kexo-accordion-general" class="accordion-collapse collapse" data-bs-parent="#settings-kexo-accordion">
                  <div class="accordion-body">
            <div id="settings-kexo-panel-general">
              <div class="card card-sm mb-3">
                <div class="card-header">
                  <h4 class="card-title">General</h4>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label" for="settings-general-app-url" title="Read-only app base URL from environment.">App URL <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                    <input type="text" class="form-control" id="settings-general-app-url" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="settings-general-timezone" title="Admin timezone for display (TODO per-install).">Admin timezone <span class="badge bg-primary-lt">TODO per-install</span> <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                    <input type="text" class="form-control" id="settings-general-timezone" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="settings-general-shop-domain" title="Read-only store domain from environment.">Store domain <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                    <input type="text" class="form-control" id="settings-general-shop-domain" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="settings-general-display-domain" title="Read-only display domain from environment.">Display domain <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                    <input type="text" class="form-control" id="settings-general-display-domain" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="settings-general-store-main" title="Read-only store main URL from environment.">Store main URL <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                    <input type="text" class="form-control" id="settings-general-store-main" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="settings-general-ingest-url" title="Read-only ingest endpoint URL from environment.">Ingest URL <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                    <input type="text" class="form-control" id="settings-general-ingest-url" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="settings-general-traffic-mode" title="Read-only acquisition mode and DB from environment.">Acquisition mode / DB <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                    <input type="text" class="form-control" id="settings-general-traffic-mode" value="—" readonly />
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="settings-general-date-format" title="Controls compact KPI compare labels like 16/2 – 16/3.">KPI date label format <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                    <select class="form-select" id="settings-general-date-format">
                      <option value="dmy">English (D/M)</option>
                      <option value="mdy">American (M/D)</option>
                    </select>
                  </div>
                  <div class="d-flex align-items-center gap-2 flex-wrap">
                    <button type="button" class="btn btn-primary" id="settings-general-save-btn">Save</button>
                    <span id="settings-general-msg" class="form-hint"></span>
                  </div>
                </div>
              </div>
            </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-kexo-accordion-icons-assets" aria-expanded="false" aria-controls="settings-kexo-accordion-icons-assets"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Icons &amp; assets</span></span></button>
                </h4>
                <div id="settings-kexo-accordion-icons-assets" class="accordion-collapse collapse" data-bs-parent="#settings-kexo-accordion">
                  <div class="accordion-body">
            <div id="settings-kexo-panel-icons-assets" class="settings-kexo-panel">
              <div class="card card-sm mb-3 kexo-brand-assets">
                <div class="card-header">
                  <h4 class="card-title">Assets</h4>
                </div>
                <div class="card-body">
                  <form id="settings-assets-form">
                    <div class="row g-3">
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-favicon" title="Upload/override favicon. PNG/ICO recommended. Saved globally; uploads stored in Cloudflare R2.">Favicon URL override <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                        <input type="url" class="form-control" id="settings-asset-favicon" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-favicon" accept="image/png,image/webp,image/jpeg,image/x-icon,image/vnd.microsoft.icon" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="favicon" data-kexo-file="settings-upload-favicon" data-kexo-url="settings-asset-favicon">Upload</button>
                        </div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-logo" title="Replaces the top-strip logo across the app. Saved globally.">Header logo URL override <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                        <input type="url" class="form-control" id="settings-asset-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-header-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="header_logo" data-kexo-file="settings-upload-header-logo" data-kexo-url="settings-asset-logo">Upload</button>
                        </div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-footer-logo" title="Replaces the footer center logo. Saved globally.">Footer logo URL override <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                        <input type="url" class="form-control" id="settings-asset-footer-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-footer-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="footer_logo" data-kexo-file="settings-upload-footer-logo" data-kexo-url="settings-asset-footer-logo">Upload</button>
                        </div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-login-logo" title="Replaces the logo shown on /app/login. Saved globally.">Login logo URL override <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                        <input type="url" class="form-control" id="settings-asset-login-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-login-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="login_logo" data-kexo-file="settings-upload-login-logo" data-kexo-url="settings-asset-login-logo">Upload</button>
                        </div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <label class="form-label" for="settings-asset-kexo-fullcolor-logo" title="Used in Settings → Diagnostics branding blocks. Saved globally.">Kexo full-color logo URL override <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                        <input type="url" class="form-control" id="settings-asset-kexo-fullcolor-logo" placeholder="https://…" />
                        <div class="input-group mt-2">
                          <input type="file" class="form-control" id="settings-upload-kexo-fullcolor-logo" accept="image/png,image/webp,image/jpeg" />
                          <button type="button" class="btn btn-outline-primary" data-kexo-asset-upload="1" data-kexo-slot="kexo_logo_fullcolor" data-kexo-file="settings-upload-kexo-fullcolor-logo" data-kexo-url="settings-asset-kexo-fullcolor-logo">Upload</button>
                        </div>
                      </div>
                    </div>

                    <div class="mt-3">
                      <button type="submit" class="btn btn-primary">Save</button>
                      <span id="settings-assets-msg" class="form-hint ms-2"></span>
                    </div>
                  </form>
                </div>
              </div>
            </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-kexo-accordion-theme-display" aria-expanded="false" aria-controls="settings-kexo-accordion-theme-display"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Theme &amp; display</span></span></button>
                </h4>
                <div id="settings-kexo-accordion-theme-display" class="accordion-collapse collapse" data-bs-parent="#settings-kexo-accordion">
                  <div class="accordion-body">
            <div id="settings-kexo-panel-theme-display" class="settings-kexo-panel">
              <div class="card card-sm kexo-brand-theme">
                <div class="card-header">
                  <h4 class="card-title" id="settings-theme-title"><span id="settings-theme-title-text">Theme</span></h4>
                </div>
                <div class="card-body" id="settings-theme-panel">
                  <div class="dm-loading">Loading theme…</div>
                </div>
              </div>
            </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-integrations" class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-integrations">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" title="Shopify + Google Ads integration status and controls.">Integrations <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></h3>
          </div>
          <div class="card-body">
            <div class="accordion settings-layout-accordion" id="settings-integrations-accordion">
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-integrations-accordion-shopify" aria-expanded="false" aria-controls="settings-integrations-accordion-shopify"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Shopify</span></span></button>
                </h4>
                <div id="settings-integrations-accordion-shopify" class="accordion-collapse collapse" data-bs-parent="#settings-integrations-accordion">
                  <div class="accordion-body">
            <div id="settings-integrations-panel-shopify">
              <div class="row g-3">
                <div class="col-12 col-xl-6">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Shopify Auth</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Shop</strong> <span id="settings-int-shopify-shop" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Token</strong> <span id="settings-int-shopify-token" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Stored scopes</strong> <span id="settings-int-shopify-scopes" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Missing scopes</strong> <span id="settings-int-shopify-missing-scopes" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-xl-6">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Truth Sync</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Sync age</strong> <span id="settings-int-shopify-sync-age" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Last sync</strong> <span id="settings-int-shopify-last-sync" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Last error</strong> <span id="settings-int-shopify-last-error" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="card card-sm">
                    <div class="card-header"><h4 class="card-title">Pixel</h4></div>
                    <div class="card-body">
                      <div class="mb-2"><strong>Installed</strong> <span id="settings-int-pixel-installed" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Pixel ingestUrl</strong> <span id="settings-int-pixel-ingest" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Expected ingestUrl</strong> <span id="settings-int-expected-ingest" class="text-muted">—</span></div>
                      <div class="mb-2"><strong>Ingest URL match</strong> <span id="settings-int-pixel-match" class="text-muted">—</span></div>
                      <div class="mb-0"><strong>Session mode</strong> <span id="settings-int-session-mode" class="text-muted">—</span></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-integrations-accordion-googleads" aria-expanded="false" aria-controls="settings-integrations-accordion-googleads"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Google Ads</span></span></button>
                </h4>
                <div id="settings-integrations-accordion-googleads" class="accordion-collapse collapse" data-bs-parent="#settings-integrations-accordion">
                  <div class="accordion-body">
            <div id="settings-integrations-panel-googleads">
              <div class="card card-sm mb-3" id="settings-ga-connection-card">
                <div class="card-header d-flex align-items-center">
                  <h4 class="card-title mb-0">Connection</h4>
                  <span class="ms-auto" id="settings-ga-connection-status">—</span>
                </div>
                <div class="card-body">
                  <div id="settings-ga-connection-disconnected">
                    <div class="text-muted small mb-3">
                      Connect your Google Ads account to enable campaign reporting and (optionally) conversion uploads.
                    </div>
                    <a class="btn btn-primary btn-sm d-inline-flex align-items-center gap-2 text-white kexo-ga-signin-btn" id="settings-ga-signin-btn" href="/api/ads/google/connect?redirect=%2Fsettings%3Ftab%3Dintegrations%26integrationsTab%3Dgoogleads">
                      <svg class="kexo-ga-signin-icon" viewBox="0 0 48 48" aria-hidden="true" focusable="false">
                        <path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303C33.65 32.657 29.229 36 24 36c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.957 3.043l5.657-5.657C34.91 6.053 29.695 4 24 4 12.955 4 4 12.955 4 24s8.955 20 20 20 20-8.955 20-20c0-1.341-.138-2.65-.389-3.917Z"></path>
                        <path fill="#FF3D00" d="M6.306 14.691 12.88 19.51C14.66 15.108 18.97 12 24 12c3.059 0 5.842 1.154 7.957 3.043l5.657-5.657C34.91 6.053 29.695 4 24 4c-7.682 0-14.36 4.327-17.694 10.691Z"></path>
                        <path fill="#4CAF50" d="M24 44c5.093 0 9.924-1.957 13.51-5.146l-6.234-5.278C29.248 35.091 26.715 36 24 36c-5.209 0-9.614-3.317-11.287-7.946l-6.523 5.025C9.49 39.556 16.227 44 24 44Z"></path>
                        <path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303a12.06 12.06 0 0 1-4.027 5.576l.001-.001 6.234 5.278C36.93 39.455 44 34 44 24c0-1.341-.138-2.65-.389-3.917Z"></path>
                      </svg>
                      Sign in with Google
                    </a>
                  </div>

                  <div id="settings-ga-connection-connected" class="d-none">
                    <div class="mb-2"><strong>Customer ID</strong> <span id="settings-ga-customer-id" class="text-muted">—</span></div>
                    <div class="mb-2"><strong>Login Customer ID (MCC)</strong> <span id="settings-ga-login-customer-id" class="text-muted">—</span></div>
                    <div class="mb-2"><strong>Conversion customer ID</strong> <span id="settings-ga-conversion-customer-id" class="text-muted">—</span></div>
                    <div class="mb-3">
                      <strong>Campaigns Import</strong> <span class="text-muted">Enabled</span> &mdash;
                      <a href="/integrations/google-ads" class="link-primary" id="settings-ga-campaigns-link">View Campaigns</a>
                    </div>
                    <div class="d-flex align-items-center gap-2 flex-wrap">
                      <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-disconnect-btn">Disconnect</button>
                    </div>
                  </div>

                  <div class="mt-2"><span id="settings-ga-connection-msg" class="form-hint"></span></div>
                </div>
              </div>

              <div id="settings-ga-when-connected" class="d-none">
              <div class="card card-sm mb-3" id="settings-ga-postbacks-master-card">
                <div class="card-header">
                  <h4 class="card-title mb-0">Campaign Goals &amp; Postbacks &mdash; Optional</h4>
                </div>
                <div class="card-body">
                  <label class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" id="settings-ga-postback-enabled" />
                    <span class="form-check-label">Enable conversion uploads to Google Ads</span>
                  </label>
                  <div class="text-muted small mt-2">
                    When enabled, attributed orders/events are uploaded to Google Ads as conversions. Nothing is sent until you turn this on.
                  </div>
                </div>
              </div>

              <div id="settings-ga-postback-details" class="d-none">
              <div class="card card-sm mb-3" id="settings-ga-postback-card">
                <div class="card-header">
                  <h4 class="card-title mb-0">Conversion uploads (postback)</h4>
                </div>
                <div class="card-body">
                  <div class="mb-2"><strong>Upload these goals</strong></div>
                  <div class="row g-2 mb-3">
                    <div class="col-12 col-md-4">
                      <label class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="settings-ga-upload-revenue" />
                        <span class="form-check-label">Revenue</span>
                      </label>
                    </div>
                    <div class="col-12 col-md-4">
                      <label class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="settings-ga-upload-profit" />
                        <span class="form-check-label">Profit</span>
                      </label>
                    </div>
                    <div class="col-12 col-md-4">
                      <label class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="settings-ga-upload-addtocart" />
                        <span class="form-check-label">Add to Cart</span>
                      </label>
                    </div>
                  </div>
                  <div class="text-muted small mb-3">
                    Uploads require a click ID on the attributed order/event (GCLID / GBRAID / WBRAID). Orders or events without click IDs are skipped and shown in diagnostics.
                  </div>
                  <div class="row g-2">
                    <div class="col-6 col-lg-3">
                      <div class="text-muted small">Last run</div>
                      <div class="fw-semibold" id="settings-ga-pb-last-run">—</div>
                    </div>
                    <div class="col-6 col-lg-3">
                      <div class="text-muted small">Jobs queued</div>
                      <div class="fw-semibold" id="settings-ga-pb-queued">—</div>
                    </div>
                    <div class="col-6 col-lg-3">
                      <div class="text-muted small">Success rate (24h)</div>
                      <div class="fw-semibold" id="settings-ga-pb-sr-24h">—</div>
                    </div>
                    <div class="col-6 col-lg-3">
                      <div class="text-muted small">Success rate (7d)</div>
                      <div class="fw-semibold" id="settings-ga-pb-sr-7d">—</div>
                    </div>
                    <div class="col-6 col-lg-3">
                      <div class="text-muted small">Failures (7d)</div>
                      <div class="fw-semibold" id="settings-ga-pb-failures-7d">—</div>
                    </div>
                    <div class="col-6 col-lg-3">
                      <div class="text-muted small">Coverage (7d)</div>
                      <div class="fw-semibold" id="settings-ga-pb-coverage-7d">—</div>
                    </div>
                    <div class="col-6 col-lg-3">
                      <div class="text-muted small">Missing click ID</div>
                      <div class="fw-semibold" id="settings-ga-pb-missing-clickid">—</div>
                    </div>
                    <div class="col-6 col-lg-3">
                      <div class="text-muted small">Rejected uploads</div>
                      <div class="fw-semibold" id="settings-ga-pb-rejected">—</div>
                    </div>
                  </div>
                  <div class="kexo-admin-only d-none mt-3">
                    <details>
                      <summary class="text-muted small" style="cursor:pointer;">Technical details</summary>
                      <pre class="dm-json-pre small mt-2 mb-0" id="settings-ga-pb-tech">—</pre>
                    </details>
                  </div>
                </div>
              </div>
              </div>

              <div id="settings-ga-postback-dependent" class="d-none">
              <div class="card card-sm mb-3" id="settings-ga-actions-card">
                <div class="card-header d-flex align-items-center">
                  <h4 class="card-title mb-0">Conversion actions (uploaded by Kexo)</h4>
                  <button type="button" class="btn btn-outline-primary btn-sm ms-auto" id="settings-ga-provision-goals-btn">Provision conversion actions</button>
                </div>
                <div class="table-responsive">
                  <table class="table table-sm table-vcenter card-table mb-0" aria-label="Google Ads conversion actions">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Status</th>
                        <th>Category</th>
                        <th class="text-center">Primary for goal</th>
                        <th class="text-end">Last upload</th>
                      </tr>
                    </thead>
                    <tbody id="settings-ga-actions-body">
                      <tr><td colspan="5" class="text-muted small">Loading…</td></tr>
                    </tbody>
                  </table>
                </div>
                <div class="card-body pt-2">
                  <div class="mb-2"><strong>Goals to create in Google Ads</strong></div>
                  <div class="row g-3 mb-2">
                    <div class="col-12 col-md-4">
                      <label class="form-check">
                        <input type="checkbox" class="form-check-input" id="settings-ga-goal-revenue" />
                        <span class="form-check-label">Revenue</span>
                      </label>
                      <div class="text-muted small">KexoRevenue (Purchase)</div>
                    </div>
                    <div class="col-12 col-md-4">
                      <label class="form-check">
                        <input type="checkbox" class="form-check-input" id="settings-ga-goal-profit" />
                        <span class="form-check-label">Profit</span>
                      </label>
                      <div class="text-muted small">KexoProfit (Purchase)</div>
                    </div>
                    <div class="col-12 col-md-4">
                      <label class="form-check">
                        <input type="checkbox" class="form-check-input" id="settings-ga-goal-addtocart" />
                        <span class="form-check-label">Add to Cart</span>
                      </label>
                      <div class="text-muted small">KexoAddToCart (Engagement)</div>
                    </div>
                  </div>
                  <div class="text-muted small">Select which conversion actions to create, then click Provision. Existing actions are left unchanged.</div>
                </div>
              </div>

              <div class="card card-sm mb-3" id="settings-ga-profit-card">
                <div class="card-header">
                  <h4 class="card-title mb-0">Profit &amp; Add to Cart (for uploads)</h4>
                </div>
                <div class="card-body">
                  <h5 class="mb-2">Profit upload value</h5>
                  <div class="text-muted small mb-2">Choose which costs to subtract from revenue when uploading Profit conversions. These settings are independent of Costs &amp; profit → Cost sources.</div>
                  <div id="settings-ga-profit-deductions" class="row g-3 mb-3">
                    <div class="col-12 col-md-6 col-lg-4">
                      <label class="form-check form-switch">
                        <input type="checkbox" class="form-check-input" id="settings-ga-deduction-google-ads" />
                        <span class="form-check-label">Google Ads spend</span>
                      </label>
                    </div>
                    <div class="col-12 col-md-6 col-lg-4">
                      <label class="form-check form-switch">
                        <input type="checkbox" class="form-check-input" id="settings-ga-deduction-payment-fees" />
                        <span class="form-check-label">Transaction Fees</span>
                      </label>
                    </div>
                    <div class="col-12 col-md-6 col-lg-4">
                      <label class="form-check form-switch">
                        <input type="checkbox" class="form-check-input" id="settings-ga-deduction-tax" />
                        <span class="form-check-label">Tax</span>
                      </label>
                    </div>
                    <div class="col-12 col-md-6 col-lg-4">
                      <label class="form-check form-switch">
                        <input type="checkbox" class="form-check-input" id="settings-ga-deduction-app-bills" />
                        <span class="form-check-label">Shopify app bills</span>
                      </label>
                    </div>
                    <div class="col-12 col-md-6 col-lg-4">
                      <label class="form-check form-switch">
                        <input type="checkbox" class="form-check-input" id="settings-ga-deduction-shipping" />
                        <span class="form-check-label">Include shipping in cost</span>
                      </label>
                    </div>
                    <div class="col-12 col-md-6 col-lg-4">
                      <label class="form-check form-switch">
                        <input type="checkbox" class="form-check-input" id="settings-ga-deduction-rules" />
                        <span class="form-check-label">Include custom rules in cost</span>
                      </label>
                    </div>
                  </div>
                  <h5 class="mb-2 mt-3">Add to Cart conversion value</h5>
                  <div class="text-muted small mb-2">Value sent for each Add to Cart conversion (usually 1).</div>
                  <div class="row g-2 align-items-center">
                    <div class="col-auto">
                      <input type="number" class="form-control form-control-sm" id="settings-ga-addtocart-value" min="0" step="0.01" value="1" style="width:5rem;" />
                    </div>
                  </div>
                  <div class="d-flex align-items-center gap-2 flex-wrap mt-3">
                    <button type="button" class="btn btn-primary btn-sm" id="settings-ga-profit-save-btn">Save</button>
                    <span id="settings-ga-profit-msg" class="form-hint"></span>
                  </div>
                </div>
              </div>

              <div class="card card-sm" id="settings-ga-diagnostics-card">
                <div class="card-header d-flex align-items-center flex-wrap gap-2">
                  <h4 class="card-title mb-0">Diagnostics</h4>
                  <div class="btn-group btn-group-sm ms-auto" role="group" aria-label="Issue filter">
                    <button type="button" class="btn btn-outline-secondary active" data-settings-ga-issue-filter="open">Open</button>
                    <button type="button" class="btn btn-outline-secondary" data-settings-ga-issue-filter="resolved">Resolved</button>
                    <button type="button" class="btn btn-outline-secondary" data-settings-ga-issue-filter="all">All</button>
                  </div>
                  <button type="button" class="btn btn-outline-secondary btn-sm" id="settings-ga-issues-refresh-btn">Refresh</button>
                </div>
                <div class="table-responsive">
                  <table class="table table-sm table-vcenter card-table mb-0" aria-label="Google Ads issues">
                    <thead>
                      <tr>
                        <th>Type</th>
                        <th>Order</th>
                        <th>Timestamp</th>
                        <th>Status</th>
                        <th class="text-end">Actions</th>
                      </tr>
                    </thead>
                    <tbody id="settings-ga-issues-body">
                      <tr><td colspan="5" class="text-muted small">Loading…</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
              </div>
              </div>
            </div>

            <div class="modal modal-blur kexo-modal-hidden" id="settings-ga-issue-modal" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="settings-ga-issue-modal-title">Issue</h5>
                    <button type="button" class="btn-close" id="settings-ga-issue-modal-close" aria-label="Close"></button>
                  </div>
                  <div class="modal-body" id="settings-ga-issue-modal-body">
                    <div class="text-muted small">Loading…</div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" id="settings-ga-issue-modal-dismiss">Close</button>
                    <button type="button" class="btn btn-primary" id="settings-ga-issue-modal-resolve">Resolve</button>
                  </div>
                </div>
              </div>
            </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-attribution" class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-attribution">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" title="Map observed tokens (UTMs, referrer host, entry URL params, explicit kexo_attr) into persisted Attribution variants (Channel + Source + Ownership).">Attribution <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></h3>
          </div>
          <div class="card-body">
            <div class="accordion settings-layout-accordion" id="settings-attribution-accordion">
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-attribution-accordion-mapping" aria-expanded="false" aria-controls="settings-attribution-accordion-mapping"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Mapping</span></span></button>
                </h4>
                <div id="settings-attribution-accordion-mapping" class="accordion-collapse collapse" data-bs-parent="#settings-attribution-accordion">
                  <div class="accordion-body">
            <div id="settings-attribution-panel-mapping">
              <div id="settings-attribution-mapping-root" class="dm-root">
                <div class="dm-loading-spinner"><div class="report-build-wrap"><div class="spinner-border text-primary" role="status"></div>                <div class="report-build-title">loading attribution mapping</div></div></div>
              </div>
            </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-attribution-accordion-tree" aria-expanded="false" aria-controls="settings-attribution-accordion-tree"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Mapped tree</span></span></button>
                </h4>
                <div id="settings-attribution-accordion-tree" class="accordion-collapse collapse" data-bs-parent="#settings-attribution-accordion">
                  <div class="accordion-body">
            <div id="settings-attribution-panel-tree">
              <div id="settings-attribution-tree-root" class="dm-root">
                <div class="dm-loading-spinner"><div class="report-build-wrap"><div class="spinner-border text-primary" role="status"></div>                <div class="report-build-title">loading mapped tree</div></div></div>
              </div>
            </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-insights" class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-insights">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" title="Create and manage custom variant mapping tables used by Insights → Variants.">Insights configuration <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></h3>
          </div>
          <div class="card-body">
            <div class="accordion settings-layout-accordion" id="settings-insights-accordion">
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-insights-accordion-variants" aria-expanded="false" aria-controls="settings-insights-accordion-variants"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Variants</span></span></button>
                </h4>
                <div id="settings-insights-accordion-variants" class="accordion-collapse collapse" data-bs-parent="#settings-insights-accordion">
                  <div class="accordion-body">
            <div id="settings-insights-layout-panel-variants">
              <div id="settings-insights-variants-root" class="dm-root">
                <div class="dm-loading">Loading variant table mappings…</div>
              </div>
              <div class="mt-3 d-flex align-items-center justify-content-between flex-wrap gap-2">
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <button type="button" class="btn btn-outline-primary" id="settings-insights-variants-suggest-btn">Suggest mappings</button>
                  <button type="button" class="btn btn-outline-danger" id="settings-insights-variants-warnings-btn" disabled>Warnings</button>
                  <button type="button" class="btn btn-outline-primary" id="settings-insights-variants-ignore-btn">Ignored List</button>
                  <button type="button" class="btn btn-outline-primary is-hidden" id="settings-insights-variants-reset-variants-btn">Reset Variants</button>
                </div>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <button type="button" class="btn btn-success" id="settings-insights-variants-save-btn">Save</button>
                </div>
              </div>
              <div class="mt-2"><span id="settings-insights-variants-msg" class="form-hint"></span></div>
              <div class="text-muted small mt-2">Save is allowed even when enabled tables have unmapped in-scope variants. You\u2019ll see warnings to help improve coverage. Overlap is auto-managed by specificity/order, and out-of-scope titles are skipped.</div>
            </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-ignore-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Ignored Variant Titles</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-ignore></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-ignore-body">
              <div class="text-secondary">Loading ignored titles…</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-ignore-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-ignore>Close</button>
                <button type="button" class="btn btn-primary" id="settings-insights-variants-ignore-save-btn">Save changes</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-suggest-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Variant mapping suggestions</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-suggest></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-suggest-body">
              <div class="text-secondary">Loading suggestions…</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-suggest-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-suggest>Close</button>
                <button type="button" class="btn btn-outline-secondary" id="settings-insights-variants-suggest-refresh-btn">Refresh from Shopify</button>
                <button type="button" class="btn btn-primary" id="settings-insights-variants-suggest-apply-btn">Apply selected</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-merge-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Merge variant labels</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-merge></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-merge-body">
              <div class="text-secondary">Loading…</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-merge-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-merge>Cancel</button>
                <button type="button" class="btn btn-primary" id="settings-insights-variants-merge-apply-btn">Merge</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal modal-blur fade" id="settings-insights-variants-warnings-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title">Variants mapping warnings</h3>
              <button type="button" class="btn-close" aria-label="Close" data-close-insights-warnings></button>
            </div>
            <div class="modal-body" id="settings-insights-variants-warnings-body">
              <div class="text-secondary">No warnings loaded yet.</div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <span id="settings-insights-variants-warnings-msg" class="form-hint"></span>
              <div class="d-flex align-items-center gap-2">
                <button type="button" class="btn btn-secondary" data-close-insights-warnings>Close</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-panel-layout" class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-layout">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" title="Configure table pagination, sticky column sizing, chart types/colors, KPI labels, and date ranges. Layout and chart settings are global.">Dashboards &amp; layout <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></h3>
          </div>
          <div class="card-body">
            <div class="accordion settings-layout-accordion" id="settings-layout-accordion">
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-layout-accordion-tables" aria-expanded="false" aria-controls="settings-layout-accordion-tables"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Tables</span></span></button>
                </h4>
                <div id="settings-layout-accordion-tables" class="accordion-collapse collapse" data-bs-parent="#settings-layout-accordion">
                  <div class="accordion-body">
            <div id="settings-layout-panel-tables">
              <div id="settings-layout-tables-root" class="dm-root">
                <div class="dm-loading">Loading tables…</div>
              </div>
              <div class="mt-3 d-flex align-items-center gap-2 flex-wrap">
                <button type="button" class="btn btn-primary" id="settings-layout-tables-save-btn">Save</button>
                <button type="button" class="btn btn-outline-secondary" id="settings-layout-tables-reset-btn">Reset to defaults</button>
                <span id="settings-layout-tables-msg" class="form-hint"></span>
              </div>
            </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-layout-accordion-kpis" aria-expanded="false" aria-controls="settings-layout-accordion-kpis"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">KPIs</span></span></button>
                </h4>
                <div id="settings-layout-accordion-kpis" class="accordion-collapse collapse" data-bs-parent="#settings-layout-accordion">
                  <div class="accordion-body">
            <div id="settings-layout-panel-kpis">
              <div class="row g-3">
                <div class="col-12">
                  <h4 class="mb-2" title="Configure labels and visibility for dashboard KPI cards and header KPI chips. Placement is automatic by enabled order.">KPIs <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></h4>

                  <div class="card card-sm mb-3">
                    <div class="card-body">
                      <div class="row g-3">
                        <div class="col-12 col-md-6 col-lg-4">
                          <label class="form-label mb-1">Header</label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-delta" />
                            <span class="form-check-label">Show % change</span>
                          </label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-progress" />
                            <span class="form-check-label">Show progress bars</span>
                          </label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-condensed-sparkline" />
                            <span class="form-check-label">Show sparklines</span>
                          </label>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                          <label class="form-label mb-1">Dashboard</label>
                          <label class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="settings-kpi-opt-dashboard-delta" />
                            <span class="form-check-label">Show % change badges</span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="card card-sm mb-3">
                    <div class="card-body">
                      <label class="form-label mb-2">Dashboard KPI placement preview</label>
                      <div id="settings-kpis-placement-preview" class="row g-2">
                        <div class="col-12"><div class="text-muted small">Loading preview…</div></div>
                      </div>
                    </div>
                  </div>

                  <div class="card card-sm mb-3">
                    <div class="card-body">
                      <label class="form-label mb-2">Header KPI strip: show on pages</label>
                      <div class="row g-2">
                        <div class="col-12 col-md-6 col-lg-4">
                          <div class="text-muted small mb-1">Dashboard</div>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="dashboard" />
                            <span class="form-check-label">Overview</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="live" />
                            <span class="form-check-label">Live View</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="sales" />
                            <span class="form-check-label">Recent Sales</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="date" />
                            <span class="form-check-label">Table View</span>
                          </label>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                          <div class="text-muted small mb-1">Insights</div>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="countries" />
                            <span class="form-check-label">Countries</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="products" />
                            <span class="form-check-label">Products</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="variants" />
                            <span class="form-check-label">Variants</span>
                          </label>
                        </div>
                        <div class="col-12 col-md-6 col-lg-4">
                        <div class="text-muted small mb-1">Acquisition + tools</div>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="attribution" />
                            <span class="form-check-label">Acquisition · Attribution</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="devices" />
                            <span class="form-check-label">Acquisition · Devices</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="ads" />
                            <span class="form-check-label">Integrations · Google Ads</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="compare-conversion-rate" />
                            <span class="form-check-label">Tools · Conversion Rate Compare</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="shipping-cr" />
                            <span class="form-check-label">Tools · Shipping CR</span>
                          </label>
                          <label class="form-check">
                            <input class="form-check-input" type="checkbox" data-kpi-header-strip-page="settings" />
                            <span class="form-check-label">Settings</span>
                          </label>
                        </div>
                      </div>
                      <div class="text-muted small mt-2">Controls the entire top KPI strip (not individual KPI chips).</div>
                    </div>
                  </div>

                  <ul class="nav nav-underline mb-3" id="settings-kpis-layout-tabs" role="tablist" aria-label="KPI layout">
                    <li class="nav-item" role="presentation">
                      <button class="nav-link active" type="button" role="tab" id="settings-kpis-layout-tab-dashboard" data-settings-kpis-layout-tab="dashboard" aria-selected="true" aria-controls="settings-kpis-layout-panel-dashboard">Dashboard</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" type="button" role="tab" id="settings-kpis-layout-tab-header" data-settings-kpis-layout-tab="header" aria-selected="false" aria-controls="settings-kpis-layout-panel-header">Header</button>
                    </li>
                  </ul>

                  <div id="settings-kpis-layout-panel-dashboard" class="settings-kpis-layout-panel active" role="tabpanel" aria-labelledby="settings-kpis-layout-tab-dashboard">
                    <div id="settings-kpis-dashboard-root" class="dm-root">
                      <div class="dm-loading">Loading KPIs…</div>
                    </div>
                  </div>
                  <div id="settings-kpis-layout-panel-header" class="settings-kpis-layout-panel" role="tabpanel" aria-labelledby="settings-kpis-layout-tab-header">
                    <div id="settings-kpis-header-root" class="dm-root">
                      <div class="dm-loading">Loading KPIs…</div>
                    </div>
                  </div>
                </div>

                <div class="col-12 d-flex align-items-center gap-2 flex-wrap">
                  <button type="button" class="btn btn-primary" id="settings-kpis-save-btn">Save</button>
                  <button type="button" class="btn btn-outline-secondary" id="settings-kpis-reset-btn">Reset to defaults</button>
                  <span id="settings-kpis-msg" class="form-hint"></span>
                </div>
              </div>
            </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-layout-accordion-date-ranges" aria-expanded="false" aria-controls="settings-layout-accordion-date-ranges"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Date ranges</span></span></button>
                </h4>
                <div id="settings-layout-accordion-date-ranges" class="accordion-collapse collapse" data-bs-parent="#settings-layout-accordion">
                  <div class="accordion-body">
            <div id="settings-layout-panel-date-ranges">
              <h4 class="mb-2" title="Configure which date ranges are available in the date dropdown.">Date ranges <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></h4>
              <div id="settings-date-ranges-root" class="dm-root">
                <div class="dm-loading">Loading date ranges…</div>
              </div>
              <p class="text-muted small mt-2">Save layout changes from the KPIs tab.</p>
            </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- KEXO_COST_EXPENSES_PANEL_START -->
      <div id="settings-panel-cost-expenses" class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-cost-expenses">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" title="Configure cost components, expense categories, and profit calculation rules.">Costs &amp; profit <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></h3>
          </div>
          <div class="card-body">
            <ul class="nav nav-tabs mb-3" id="settings-cost-expenses-tabs" role="tablist" aria-label="Costs &amp; profit tabs">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" type="button" role="tab" id="settings-cost-expenses-tab-cost-sources" data-settings-cost-expenses-tab="cost-sources" aria-selected="true" aria-controls="settings-cost-expenses-panel-cost-sources">Cost sources</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-cost-expenses-tab-shipping" data-settings-cost-expenses-tab="shipping" aria-selected="false" aria-controls="settings-cost-expenses-panel-shipping">Shipping costs</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-cost-expenses-tab-rules" data-settings-cost-expenses-tab="rules" aria-selected="false" aria-controls="settings-cost-expenses-panel-rules">Rules &amp; adjustments</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" type="button" role="tab" id="settings-cost-expenses-tab-breakdown" data-settings-cost-expenses-tab="breakdown" aria-selected="false" aria-controls="settings-cost-expenses-panel-breakdown">Cost Breakdown</button>
              </li>
            </ul>
            <div id="settings-cost-expenses-panel-cost-sources" class="settings-cost-expenses-panel active" role="tabpanel" aria-labelledby="settings-cost-expenses-tab-cost-sources">
              <h4 class="mb-1">Enable/Disable Costs</h4>
              <div class="text-muted small mb-3">Choose which costs are included in profit KPIs and the Insights Snapshot.</div>
              <div id="settings-cost-expenses-sources">
                <div class="row g-3">
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="form-check form-switch d-flex align-items-center gap-2">
                      <input class="form-check-input" type="checkbox" id="cost-expenses-google-ads" />
                      <span class="form-check-label">Google Ads spend</span>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="form-check form-switch d-flex align-items-center gap-2">
                      <input class="form-check-input" type="checkbox" id="cost-expenses-payment-fees" />
                      <span class="form-check-label">Transaction Fees</span>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="form-check form-switch d-flex align-items-center gap-2">
                      <input class="form-check-input" type="checkbox" id="cost-expenses-tax" />
                      <span class="form-check-label">Tax</span>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="form-check form-switch d-flex align-items-center gap-2">
                      <input class="form-check-input" type="checkbox" id="cost-expenses-app-bills" />
                      <span class="form-check-label">Shopify app bills</span>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="form-check form-switch d-flex align-items-center gap-2">
                      <input class="form-check-input" type="checkbox" id="cost-expenses-shipping-enabled" />
                      <span class="form-check-label">Include shipping in cost</span>
                    </label>
                  </div>
                  <div class="col-12 col-md-6 col-lg-4">
                    <label class="form-check form-switch d-flex align-items-center gap-2">
                      <input class="form-check-input" type="checkbox" id="cost-expenses-rules-enabled" />
                      <span class="form-check-label">Include custom rules in cost</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <div id="settings-cost-expenses-panel-shipping" class="settings-cost-expenses-panel" role="tabpanel" aria-labelledby="settings-cost-expenses-tab-shipping">
              <div class="card card-sm mb-3">
                <div class="card-body">
                  <label class="form-label" for="cost-expenses-shipping-worldwide" title="Default per-order shipping cost (GBP) when no country override matches.">Worldwide default (per order, GBP) <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                  <input type="number" class="form-control" id="cost-expenses-shipping-worldwide" min="0" step="0.01" placeholder="e.g. 3.99" />
                  <div id="cost-expenses-shipping-excluded-hint" class="text-muted small mt-2 is-hidden">Shipping is currently excluded from Cost sources.</div>
                </div>
              </div>
              <div class="d-flex align-items-center justify-content-between mb-2">
                <h5 class="mb-0">Country overrides</h5>
                <button type="button" class="btn btn-sm btn-outline-primary" id="cost-expenses-shipping-add-override">Add override</button>
              </div>
              <div class="text-muted small mb-2">Overrides apply per order. Enter ISO2 country codes (comma-separated). Priority is evaluated low → high; first match wins.</div>
              <div class="table-responsive">
                <table class="table table-sm align-middle">
                  <thead>
                    <tr>
                      <th><span title="Lower number = higher priority. Overrides are evaluated in priority order; first match wins.">Priority <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></span></th>
                      <th class="text-center"><span title="Disable to ignore this override without deleting it.">On <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></span></th>
                      <th><span title="Per-order shipping cost in GBP for matching countries.">Price (GBP) <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></span></th>
                      <th><span title="Comma-separated ISO2 country codes. Example: GB, IE, FR">Countries <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></span></th>
                      <th class="text-end">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="cost-expenses-shipping-overrides-wrap"></tbody>
                </table>
              </div>
              <div id="cost-expenses-shipping-dup-warn" class="text-warning small mt-2 is-hidden" role="alert"></div>
            </div>
            <div id="settings-cost-expenses-panel-rules" class="settings-cost-expenses-panel" role="tabpanel" aria-labelledby="settings-cost-expenses-tab-rules">
              <div id="cost-expenses-rules-excluded-hint" class="text-muted small mb-2 is-hidden">Rules are currently excluded from Cost sources.</div>
              <div class="d-flex align-items-center justify-content-between mb-2">
                <h6 class="m-0">Rules</h6>
                <button type="button" class="btn btn-sm btn-outline-primary" id="cost-expenses-rules-add-btn">Add rule</button>
              </div>
              <div class="text-muted small mb-2">Rules run in priority order. Scope can be All countries or specific ISO country codes.</div>
              <div id="cost-expenses-rules-msg" class="is-hidden"></div>
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>Rule</th>
                      <th>Type</th>
                      <th class="text-end">Value</th>
                      <th class="text-center">Country</th>
                      <th class="text-center">Enabled</th>
                      <th class="text-end">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="cost-expenses-rules-table-body"></tbody>
                </table>
              </div>
              <div class="card mt-3 is-hidden" id="cost-expenses-rules-form-wrap">
                <div class="card-body">
                  <input type="hidden" id="cost-expenses-rule-id" />
                  <div class="row g-2">
                    <div class="col-12 col-md-4">
                      <label class="form-label">Name</label>
                      <input type="text" id="cost-expenses-rule-name" class="form-control" placeholder="e.g. Payment fees" />
                    </div>
                    <div class="col-12 col-md-3">
                      <label class="form-label">Type</label>
                      <select id="cost-expenses-rule-type" class="form-select">
                        <option value="percent_revenue">% of revenue</option>
                        <option value="fixed_per_order">Fixed per order</option>
                        <option value="fixed_per_period">Fixed per period</option>
                      </select>
                    </div>
                    <div class="col-12 col-md-2">
                      <label class="form-label">Value</label>
                      <input type="number" id="cost-expenses-rule-value" class="form-control" min="0" step="0.01" placeholder="e.g. 2.9" />
                    </div>
                    <div class="col-12 col-md-2">
                      <label class="form-label">Country</label>
                      <input type="text" id="cost-expenses-rule-country" class="form-control" placeholder="ALL or GB,IE,FR" title="ALL or comma-separated ISO codes" />
                    </div>
                    <div class="col-12 col-md-1">
                      <label class="form-label">Sort</label>
                      <input type="number" id="cost-expenses-rule-sort" class="form-control" min="1" step="1" placeholder="e.g. 10" />
                    </div>
                  </div>
                  <label class="form-check mt-2">
                    <input class="form-check-input" type="checkbox" id="cost-expenses-rule-enabled" checked />
                    <span class="form-check-label">Rule enabled</span>
                  </label>
                  <div class="d-flex gap-2 mt-3">
                    <button type="button" class="btn btn-primary" id="cost-expenses-rule-save-btn">Save rule</button>
                    <button type="button" class="btn btn-ghost-secondary" id="cost-expenses-rule-cancel-btn">Cancel</button>
                  </div>
                </div>
              </div>
            </div>
            <div id="settings-cost-expenses-panel-breakdown" class="settings-cost-expenses-panel" role="tabpanel" aria-labelledby="settings-cost-expenses-tab-breakdown">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
                <h4 class="m-0">Cost Breakdown</h4>
                <div class="btn-group" role="group" aria-label="Cost breakdown date range" id="cost-breakdown-range-group">
                  <button type="button" class="btn btn-sm btn-outline-primary" data-cost-breakdown-range="today">Today</button>
                  <button type="button" class="btn btn-sm btn-outline-primary" data-cost-breakdown-range="yesterday">Yesterday</button>
                  <button type="button" class="btn btn-sm btn-outline-primary" data-cost-breakdown-range="7d">7 Days</button>
                  <button type="button" class="btn btn-sm btn-outline-primary" data-cost-breakdown-range="30d">30 Days</button>
                </div>
              </div>
              <div class="text-muted small mb-2">Inactive rows are shown muted but amounts are still calculated for comparison.</div>
              <div id="cost-breakdown-msg" class="form-hint mb-2"></div>
              <div class="table-responsive">
                <table class="table table-sm align-middle">
                  <thead>
                    <tr>
                      <th>Cost item</th>
                      <th>Status</th>
                      <th class="text-end">Amount</th>
                      <th>Notes</th>
                    </tr>
                  </thead>
                  <tbody id="cost-breakdown-table-body">
                    <tr><td colspan="4" class="text-muted small">Select a date range to load a breakdown.</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="card card-sm mt-3">
                <div class="card-body">
                  <div class="row g-2">
                    <div class="col-12 col-md-6">
                      <div class="text-muted small">Total Active Costs</div>
                      <div class="h3 m-0" id="cost-breakdown-total-active">—</div>
                    </div>
                    <div class="col-12 col-md-6">
                      <div class="text-muted small">Total Inactive Costs</div>
                      <div class="h3 m-0" id="cost-breakdown-total-inactive">—</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="d-flex align-items-center gap-2 flex-wrap mt-3">
              <button type="button" class="btn btn-primary" id="cost-expenses-save-btn">Save</button>
              <span id="cost-expenses-msg" class="form-hint"></span>
            </div>
          </div>
        </div>
      </div>
      <!-- KEXO_COST_EXPENSES_PANEL_END -->

      <!-- KEXO_ADMIN_PANEL_START -->
      <div id="settings-panel-admin" class="settings-panel kexo-admin-only d-none" role="tabpanel" aria-labelledby="settings-tab-admin">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" title="Admin controls apply globally. Admin is always loader-disabled.">Admin (admin-only) <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></h3>
          </div>
          <div class="card-body" id="settings-admin-root">
            <div class="accordion settings-layout-accordion" id="settings-admin-accordion">
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-controls" aria-expanded="false" aria-controls="settings-admin-accordion-controls"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Controls</span></span></button>
                </h4>
                <div id="settings-admin-accordion-controls" class="accordion-collapse collapse" data-bs-parent="#settings-admin-accordion">
                  <div class="accordion-body">
            <div id="admin-panel-controls">
              <div class="accordion settings-layout-accordion" id="settings-admin-controls-accordion">
                <div class="accordion-item">
                  <h4 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-preview" aria-expanded="false" aria-controls="settings-admin-accordion-preview"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Preview</span></span></button>
                  </h4>
                  <div id="settings-admin-accordion-preview" class="accordion-collapse collapse" data-bs-parent="#settings-admin-controls-accordion">
                    <div class="accordion-body">
                      <label class="form-label mb-2" for="admin-preview-tier" title="Preview affects UI only; server access remains your real account.">Preview as tier <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                      <div class="row g-3 align-items-end">
                        <div class="col-12 col-lg-6">
                          <select class="form-select" id="admin-preview-tier" aria-label="Preview as tier">
                            <option value="" selected>Off</option>
                            <option value="starter">Starter</option>
                            <option value="growth">Growth</option>
                            <option value="scale">Scale</option>
                            <option value="max">Max</option>
                            <option value="admin">Admin</option>
                          </select>
                        </div>
                        <div class="col-12 col-lg-6 d-flex gap-2">
                          <button type="button" class="btn btn-outline-secondary" id="admin-preview-exit-btn">Exit preview</button>
                        </div>
                      </div>
                      <div class="form-hint mt-2" id="admin-preview-msg"></div>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h4 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-loader" aria-expanded="false" aria-controls="settings-admin-accordion-loader"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Loader</span></span></button>
                  </h4>
                  <div id="settings-admin-accordion-loader" class="accordion-collapse collapse" data-bs-parent="#settings-admin-controls-accordion">
                    <div class="accordion-body">
                      <div class="mb-2" title="Enable or disable the page loader overlay per page. Admin loader is always disabled.">Loader <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></div>
                      <div id="admin-loader-toggles" class="d-grid gap-2">
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-dashboard" data-admin-loader-page="dashboard" />
                          <label class="form-check-label" for="admin-loader-dashboard">Enable loader on Overview</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-live" data-admin-loader-page="live" />
                          <label class="form-check-label" for="admin-loader-live">Enable loader on Live View</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-sales" data-admin-loader-page="sales" />
                          <label class="form-check-label" for="admin-loader-sales">Enable loader on Recent Sales</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-date" data-admin-loader-page="date" />
                          <label class="form-check-label" for="admin-loader-date">Enable loader on Table View</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-countries" data-admin-loader-page="countries" />
                          <label class="form-check-label" for="admin-loader-countries">Enable loader on Countries</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-products" data-admin-loader-page="products" />
                          <label class="form-check-label" for="admin-loader-products">Enable loader on Products</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-variants" data-admin-loader-page="variants" />
                          <label class="form-check-label" for="admin-loader-variants">Enable loader on Variants</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-abandoned-carts" data-admin-loader-page="abandoned-carts" />
                          <label class="form-check-label" for="admin-loader-abandoned-carts">Enable loader on Abandoned Carts</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-channels" data-admin-loader-page="channels" />
                          <label class="form-check-label" for="admin-loader-channels">Enable loader on Channels</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-type" data-admin-loader-page="type" />
                          <label class="form-check-label" for="admin-loader-type">Enable loader on Device &amp; Platform</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-ads" data-admin-loader-page="ads" />
                          <label class="form-check-label" for="admin-loader-ads">Enable loader on Google Ads</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-compare-conversion-rate" data-admin-loader-page="compare-conversion-rate" />
                          <label class="form-check-label" for="admin-loader-compare-conversion-rate">Enable loader on Compare Conversion Rate</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-shipping-cr" data-admin-loader-page="shipping-cr" />
                          <label class="form-check-label" for="admin-loader-shipping-cr">Enable loader on Shipping CR</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="admin-loader-settings" data-admin-loader-page="settings" disabled />
                          <label class="form-check-label" for="admin-loader-settings">Settings loader locked off</label>
                        </div>
                      </div>
                      <div class="form-hint mt-2">Admin loader is always disabled.</div>
                      <div class="form-hint mt-1" id="admin-loader-msg"></div>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h4 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-reporting" aria-expanded="false" aria-controls="settings-admin-accordion-reporting"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Data &amp; Reporting</span></span></button>
                  </h4>
                  <div id="settings-admin-accordion-reporting" class="accordion-collapse collapse" data-bs-parent="#settings-admin-controls-accordion">
                    <div class="accordion-body">
                      <div class="row g-3">
                        <div class="col-12 col-lg-6">
                          <label class="form-label" for="admin-orders-source" title="Orders source, sessions source, and pixel session mode. Auto-saves on change.">Orders source <i class="fa-thin fa-circle-info text-secondary ms-1 am-tooltip-cue" aria-hidden="true"></i></label>
                          <select class="form-select" id="admin-orders-source">
                            <option value="orders_shopify">orders_shopify</option>
                          </select>
                        </div>
                        <div class="col-12 col-lg-6">
                          <label class="form-label" for="admin-sessions-source">Sessions source</label>
                          <select class="form-select" id="admin-sessions-source">
                            <option value="sessions">sessions</option>
                            <option value="shopify_sessions">shopify_sessions</option>
                          </select>
                        </div>
                        <div class="col-12">
                          <label class="form-label">Pixel session mode</label>
                          <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="admin-pixel-session-mode" />
                            <label class="form-check-label" for="admin-pixel-session-mode">Share session across tabs (30m inactivity)</label>
                          </div>
                        </div>
                      </div>
                      <div class="form-hint mt-2" id="admin-reporting-msg"></div>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h4 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-scope" aria-expanded="false" aria-controls="settings-admin-accordion-scope"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Settings scope</span></span></button>
                  </h4>
                  <div id="settings-admin-accordion-scope" class="accordion-collapse collapse" data-bs-parent="#settings-admin-controls-accordion">
                    <div class="accordion-body">
                      <div class="text-secondary small mb-3">All settings currently apply globally (shared). Per-user settings are coming later.</div>
                      <div class="form-selectgroup" role="group" aria-label="Settings scope">
                        <label class="form-selectgroup-item flex-fill">
                          <input type="radio" name="admin-settings-scope-mode" value="global" class="form-selectgroup-input" id="admin-settings-scope-global" checked disabled>
                          <div class="form-selectgroup-label d-flex align-items-center justify-content-center p-2">
                            <span class="form-selectgroup-label-content">Global (shared)</span>
                          </div>
                        </label>
                        <label class="form-selectgroup-item flex-fill">
                          <input type="radio" name="admin-settings-scope-mode" value="user" class="form-selectgroup-input" id="admin-settings-scope-user" disabled>
                          <div class="form-selectgroup-label d-flex align-items-center justify-content-center p-2">
                            <span class="form-selectgroup-label-content">User-selected</span>
                          </div>
                        </label>
                      </div>
                      <div class="text-secondary small mt-2">User-selected scope is disabled for now.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-diagnostics" aria-expanded="false" aria-controls="settings-admin-accordion-diagnostics"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Diagnostics</span></span></button>
                </h4>
                <div id="settings-admin-accordion-diagnostics" class="accordion-collapse collapse" data-bs-parent="#settings-admin-accordion">
                  <div class="accordion-body">
            <div id="admin-panel-diagnostics">
              <div class="card">
                <div class="card-header d-flex align-items-center justify-content-between flex-wrap gap-2">
                  <h3 class="card-title mb-0"><i class="fa-thin fa-chart-line me-2" data-icon-key="admin-tab-diagnostics" aria-hidden="true"></i>Diagnostics</h3>
                  <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end">
                    <div class="d-flex align-items-center gap-2">
                      <span class="text-secondary small">Range</span>
                      <select id="diagnostics-overview-range" class="form-select form-select-sm kexo-diagnostics-range-select" aria-label="Diagnostics overview range">
                        <option value="today" selected>Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="7d">Last 7 days</option>
                        <option value="14d">Last 14 days</option>
                        <option value="30d">Last 30 days</option>
                      </select>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-primary" id="config-refresh-btn" aria-label="Refresh diagnostics">
                      <i class="fa-thin fa-rotate-right" data-icon-key="settings-diagnostics-refresh" aria-hidden="true"></i> Refresh
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="config-reconcile-btn" aria-label="Reconcile sales">
                      <i class="fa-thin fa-sliders" data-icon-key="settings-diagnostics-reconcile" aria-hidden="true"></i> Reconcile
                    </button>
                    <span id="config-action-msg" class="form-hint"></span>
                  </div>
                </div>
                <div class="card-body">
                  <div class="text-secondary small mb-3">
                    <strong>Refresh</strong> re-reads diagnostics only. <strong>Reconcile</strong> runs a manual Shopify truth sync for the last 7 days, then refreshes diagnostics.
                  </div>
                  <div id="diagnostics-content">
                    <div class="d-flex align-items-center gap-2 text-secondary">
                      <div class="spinner-border spinner-border-sm text-primary" role="status" aria-hidden="true"></div>
                      <div>Loading diagnostics…</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h4 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#settings-admin-accordion-users" aria-expanded="false" aria-controls="settings-admin-accordion-users"><span class="d-flex align-items-center w-100 gap-2"><span class="kexo-settings-accordion-chevron" aria-hidden="true"><i class="fa-regular fa-chevron-down" aria-hidden="true"></i></span><span class="me-auto">Users</span></span></button>
                </h4>
                <div id="settings-admin-accordion-users" class="accordion-collapse collapse" data-bs-parent="#settings-admin-accordion">
                  <div class="accordion-body">
            <div id="admin-panel-users">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title"><i class="fa-thin fa-users me-2" data-icon-key="admin-tab-users" aria-hidden="true"></i>Users</h3>
                </div>
                <div class="card-body">
                  <div class="text-secondary small mb-3">Pending accounts are blocked everywhere until approved.</div>
                  <ul class="nav nav-underline mb-3" id="settings-admin-users-tabs" role="tablist" aria-label="Users">
                    <li class="nav-item" role="presentation">
                      <button class="nav-link active" type="button" role="tab" id="settings-admin-users-tab-active" data-admin-users-tab="active" aria-selected="true" aria-controls="admin-users-active">Active</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" type="button" role="tab" id="settings-admin-users-tab-pending" data-admin-users-tab="pending" aria-selected="false" aria-controls="admin-users-pending">Pending</button>
                    </li>
                  </ul>
                  <div id="admin-users-active" class="admin-users-pane active" role="tabpanel" aria-labelledby="settings-admin-users-tab-active">
                    <div class="table-responsive">
                      <table class="table table-vcenter card-table table-sm admin-users-table">
                        <thead>
                          <tr>
                            <th>Email</th>
                            <th>Country</th>
                            <th>City</th>
                            <th>Device</th>
                            <th>Last login</th>
                            <th class="text-end">Actions</th>
                          </tr>
                        </thead>
                        <tbody id="admin-users-active-body">
                          <tr><td colspan="6" class="text-secondary">Loading…</td></tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div id="admin-users-pending" class="admin-users-pane" role="tabpanel" aria-labelledby="settings-admin-users-tab-pending">
                    <div class="table-responsive">
                      <table class="table table-vcenter card-table table-sm admin-users-table">
                        <thead>
                          <tr>
                            <th>Email</th>
                            <th>Country</th>
                            <th>City</th>
                            <th>Device</th>
                            <th>Registered</th>
                            <th class="text-end">Actions</th>
                          </tr>
                        </thead>
                        <tbody id="admin-users-pending-body">
                          <tr><td colspan="6" class="text-secondary">Loading…</td></tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- KEXO_ADMIN_PANEL_END -->

    </div>
  </div>

  <!-- Mobile settings drawer (mobile-only, shown via JS) -->
  <div id="settings-mobile-drawer-backdrop" class="settings-mobile-backdrop" hidden></div>
  <aside id="settings-mobile-drawer" class="settings-mobile-drawer" role="dialog" aria-modal="true" aria-label="Settings menu" tabindex="-1" hidden>
    <div class="settings-mobile-drawer-header">
      <div class="fw-semibold">Settings menu</div>
      <button type="button" class="btn btn-ghost-secondary btn-icon" id="settings-mobile-menu-close" aria-label="Close settings menu">
        <i class="fa-thin fa-xmark" aria-hidden="true"></i>
      </button>
    </div>
    <div class="settings-mobile-drawer-body">
      <div id="settings-mobile-drawer-menu" class="settings-mobile-menu"></div>
    </div>
  </aside>

  <!--#include partials/page-body-end.html-->
  <!--#include partials/footer.html-->
  <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/js/tabler.min.js"></script>
  <script src="/kexo-table-builder.js"></script>
  <script src="/kexo-table-defs.js"></script>
  <script src="/kexo-chart-defs.js"></script>
  <script src="/kexo-chart-builder.js"></script>
  <script src="/app.js"></script>
  <script src="/kexo-tooltips.js"></script>
  <script src="/theme-settings.js" defer></script>
  <script src="/attribution-mapping-settings.js"></script>
  <script src="/attribution-tree-settings.js"></script>
  <!-- KEXO_COST_EXPENSES_SCRIPT_START -->
  <script src="/cost-expenses-settings.js"></script>
  <script src="/cost-breakdown-settings.js"></script>
  <!-- KEXO_COST_EXPENSES_SCRIPT_END -->
  <script src="/settings-page.js"></script>
  <!-- KEXO_ADMIN_SCRIPT_START -->
  <script src="/admin-page.js"></script>
  <!-- KEXO_ADMIN_SCRIPT_END -->
</body>
</html>
