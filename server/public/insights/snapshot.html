<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!--#include partials/head-theme.html-->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon" type="image/webp" href="/assets/logos/new/kexo.webp" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler-flags.min.css" />
  <link rel="stylesheet" href="/tabler-theme.css" />
  <link rel="stylesheet" href="/custom.css" />
  <link rel="stylesheet" href="/diagnostics-modal.css" />
  <title>Kexo · Snapshot</title>
</head>
<body class="" data-page="snapshot">
  <!--#include partials/header.html-->
  <!--#include partials/page-body-start.html-->
  <div class="page-header mb-3">
    <div class="row align-items-center kexo-page-header-layout-triple kexo-page-header-accent-teal kexo-page-header-accent-snapshot">
      <div class="col-auto kexo-page-header-left-col">
        <div class="page-pretitle"><i class="kexo-nav-svg kexo-page-header-category-icon kexo-accent-2 fa-jelly-fill fa-regular fa-chart-pie" data-icon-key="nav-toggle-breakdown" aria-hidden="true"></i>Insights</div>
      </div>
      <div class="col kexo-page-header-title-col">
        <h2 class="page-title">Snapshot</h2>
      </div>
      <div class="col-auto kexo-page-header-date-col">
        <div class="dropdown kexo-topbar-date">
          <button type="button" class="kexo-date-btn" id="snapshot-date-display" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Choose date range" aria-controls="snapshot-date-menu">
            <span class="kexo-date-btn-label" id="snapshot-date-btn-label">Last 7 days</span>
            <i class="kexo-date-btn-chevron fa-light fa-chevron-down" data-icon-key="topnav-date-chevron" aria-hidden="true"></i>
          </button>
          <div class="dropdown-menu dropdown-menu-end" id="snapshot-date-menu" aria-label="Date ranges">
            <button class="dropdown-item" type="button" data-preset="this_month">This month</button>
            <button class="dropdown-item" type="button" data-preset="last_month">Last month</button>
            <button class="dropdown-item" type="button" data-preset="last_7_days">Last 7 days</button>
            <button class="dropdown-item" type="button" data-preset="last_30_days">Last 30 days</button>
            <button class="dropdown-item" type="button" data-preset="last_90_days">Last 90 days</button>
            <button class="dropdown-item" type="button" data-preset="last_6_months">Last 6 months</button>
            <button class="dropdown-item" type="button" data-preset="ytd">Year to date</button>
            <div class="dropdown-divider"></div>
            <button class="dropdown-item" type="button" data-preset="custom">Custom…</button>
          </div>
        </div>
        <div class="snapshot-custom-only is-hidden d-flex align-items-center gap-1 mt-1" id="snapshot-custom-start-wrap">
          <input id="snapshot-custom-start" type="date" class="form-control form-control-sm snapshot-date-input" aria-label="Start date" />
          <span class="text-muted small">–</span>
        </div>
        <div class="snapshot-custom-only is-hidden d-flex align-items-center gap-1 mt-1" id="snapshot-custom-end-wrap">
          <input id="snapshot-custom-end" type="date" class="form-control form-control-sm snapshot-date-input" aria-label="End date" />
          <button type="button" id="snapshot-custom-apply-btn" class="btn btn-sm btn-primary">Apply</button>
        </div>
      </div>
    </div>
    <div class="small text-muted mt-2 text-center" id="snapshot-compare-line" aria-live="polite">
      This period compared with previous period
    </div>
  </div>

  <div id="tab-panel-snapshot" class="main-tab-panel active" role="tabpanel" aria-labelledby="nav-tab-snapshot">

    <div class="card mb-3 is-hidden" id="snapshot-not-authorized">
      <div class="card-body py-5 text-center">
        <h3 class="card-title mb-2">Not authorised</h3>
        <p class="text-muted mb-0">This page is only available to admin users.</p>
      </div>
    </div>

    <div id="snapshot-content">
      <div class="card mb-3 snapshot-group-card" data-snapshot-group="revenue-cost" data-no-card-collapse="1">
        <div class="card-header d-flex align-items-center flex-wrap gap-2">
          <h3 class="card-title mb-0">Revenue &amp; Cost</h3>
          <div class="dropdown ms-auto">
            <button type="button" class="btn btn-sm btn-ghost-secondary" id="snapshot-revenue-cost-settings-btn" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Revenue &amp; Cost settings" aria-haspopup="true">
              Settings
            </button>
            <div class="dropdown-menu dropdown-menu-end" id="snapshot-revenue-cost-settings-menu" aria-label="Revenue &amp; Cost settings">
              <button type="button" class="dropdown-item" id="snapshot-rounding-toggle-dropdown" data-action="toggle-rounding">Rounding Numbers: On</button>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" id="snapshot-profit-settings-link" href="/settings/cost-expenses/rules">Profit settings</a>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="snapshot-group-loading" id="snapshot-revenue-cost-loading" aria-live="polite">
            <div class="d-flex align-items-center gap-2 text-muted"><span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading revenue and cost</div>
          </div>
          <div class="snapshot-group-error is-hidden" id="snapshot-revenue-cost-error" role="alert">
            <div class="alert alert-danger d-flex flex-wrap align-items-center justify-content-between gap-2 mb-0">
              <span>Could not load Revenue &amp; Cost right now.</span>
              <button type="button" class="btn btn-sm btn-danger" id="snapshot-revenue-cost-retry">Retry</button>
            </div>
          </div>
          <div class="snapshot-group-ready is-hidden" id="snapshot-revenue-cost-ready">
            <div class="table-responsive">
              <table class="table table-sm card-table table-vcenter snapshot-kpi-table" aria-label="Revenue and cost metrics">
                <thead>
                  <tr>
                    <th scope="col">Metric</th>
                    <th scope="col" class="text-end">This period</th>
                    <th scope="col" class="text-end">Previous</th>
                    <th scope="col" class="text-end">Delta</th>
                    <th scope="col" class="text-end">Delta %</th>
                  </tr>
                </thead>
                <tbody id="snapshot-revenue-cost-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-3 snapshot-group-card" data-snapshot-group="performance">
        <div class="card-header d-flex align-items-center flex-wrap gap-2">
          <h3 class="card-title mb-0">Performance</h3>
        </div>
        <div class="card-body">
          <div class="snapshot-group-loading" id="snapshot-performance-loading" aria-live="polite">
            <div class="d-flex align-items-center gap-2 text-muted"><span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading performance metrics</div>
          </div>
          <div class="snapshot-group-error is-hidden" id="snapshot-performance-error" role="alert">
            <div class="alert alert-danger d-flex flex-wrap align-items-center justify-content-between gap-2 mb-0">
              <span>Could not load Performance right now.</span>
              <button type="button" class="btn btn-sm btn-danger" id="snapshot-performance-retry">Retry</button>
            </div>
          </div>
          <div class="snapshot-group-ready is-hidden" id="snapshot-performance-ready">
            <div class="table-responsive">
              <table class="table table-sm card-table table-vcenter snapshot-kpi-table" aria-label="Performance metrics">
                <thead>
                  <tr>
                    <th scope="col">Metric</th>
                    <th scope="col" class="text-end">This period</th>
                    <th scope="col" class="text-end">Previous</th>
                    <th scope="col" class="text-end">Delta</th>
                    <th scope="col" class="text-end">Delta %</th>
                  </tr>
                </thead>
                <tbody id="snapshot-performance-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-3 snapshot-group-card" data-snapshot-group="customers">
        <div class="card-header d-flex align-items-center flex-wrap gap-2">
          <h3 class="card-title mb-0">Customers</h3>
        </div>
        <div class="card-body">
          <div class="snapshot-group-loading" id="snapshot-customers-loading" aria-live="polite">
            <div class="d-flex align-items-center gap-2 text-muted"><span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading customer metrics</div>
          </div>
          <div class="snapshot-group-error is-hidden" id="snapshot-customers-error" role="alert">
            <div class="alert alert-danger d-flex flex-wrap align-items-center justify-content-between gap-2 mb-0">
              <span>Could not load Customers right now.</span>
              <button type="button" class="btn btn-sm btn-danger" id="snapshot-customers-retry">Retry</button>
            </div>
          </div>
          <div class="snapshot-group-ready is-hidden" id="snapshot-customers-ready">
            <div class="table-responsive">
              <table class="table table-sm card-table table-vcenter snapshot-kpi-table" aria-label="Customer metrics">
                <thead>
                  <tr>
                    <th scope="col">Metric</th>
                    <th scope="col" class="text-end">This period</th>
                    <th scope="col" class="text-end">Previous</th>
                    <th scope="col" class="text-end">Delta</th>
                    <th scope="col" class="text-end">Delta %</th>
                  </tr>
                </thead>
                <tbody id="snapshot-customers-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal modal-blur kexo-modal-hidden" id="profit-rules-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="dialog" aria-modal="true" aria-label="Profit Rules">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Profit Rules</h5>
          <button type="button" class="btn-close" id="profit-rules-close-btn" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul class="nav nav-tabs mb-3">
            <li class="nav-item"><button type="button" class="nav-link active" data-pr-tab="rules">Rules</button></li>
            <li class="nav-item"><button type="button" class="nav-link" data-pr-tab="integrations">Integrations</button></li>
          </ul>

          <div class="mb-3" id="profit-rules-tab-rules">
            <label class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" id="profit-rules-enabled" />
              <span class="form-check-label">Enable estimated profit in Snapshot</span>
            </label>

            <div class="mb-3">
              <h6 class="mb-2">Additional cost groups</h6>
              <div class="d-flex flex-column gap-2">
                <label class="form-check form-switch mb-0">
                  <input class="form-check-input" type="checkbox" id="profit-rules-include-payment-fees" />
                  <span class="form-check-label">Include Transaction Fees in Cost</span>
                </label>
                <label class="form-check form-switch mb-0">
                  <input class="form-check-input" type="checkbox" id="profit-rules-include-klarna-fees" />
                  <span class="form-check-label">Include Shopify Fees in Cost</span>
                </label>
                <label class="form-check form-switch mb-0">
                  <input class="form-check-input" type="checkbox" id="profit-rules-include-tax" />
                  <span class="form-check-label">Include Tax in Cost</span>
                </label>
              </div>
              <div class="text-muted small mt-2">These toggles are included in Snapshot Cost, cost chart, and estimated profit deductions.</div>
            </div>

            <div class="d-flex align-items-center justify-content-between mb-2">
              <h6 class="m-0">Rules</h6>
              <button type="button" class="btn btn-sm btn-primary" id="profit-rules-add-btn">Add rule</button>
            </div>
            <div class="text-muted small mb-2">Rules run in priority order. Scope can be All countries or a specific ISO country code.</div>

            <div id="profit-rules-msg" class="is-hidden"></div>

            <div class="table-responsive">
              <table class="table table-sm">
                <thead>
                  <tr>
                    <th>Rule</th>
                    <th>Type</th>
                    <th class="text-end">Value</th>
                    <th class="text-center">Country</th>
                    <th class="text-center">Enabled</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody id="profit-rules-table-body"></tbody>
              </table>
            </div>

            <div class="card mt-3 is-hidden" id="profit-rules-form-wrap">
              <div class="card-body">
                <input type="hidden" id="profit-rule-id" />
                <div class="row g-2">
                  <div class="col-12 col-md-4">
                    <label class="form-label">Name</label>
                    <input type="text" id="profit-rule-name" class="form-control" />
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Type</label>
                    <select id="profit-rule-type" class="form-select">
                      <option value="percent_revenue">% of revenue</option>
                      <option value="fixed_per_order">Fixed per order</option>
                      <option value="fixed_per_period">Fixed per period</option>
                    </select>
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Value</label>
                    <input type="number" id="profit-rule-value" class="form-control" min="0" step="0.01" />
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Country</label>
                    <input type="text" id="profit-rule-country" class="form-control" maxlength="2" placeholder="ALL" />
                  </div>
                  <div class="col-12 col-md-1">
                    <label class="form-label">Sort</label>
                    <input type="number" id="profit-rule-sort" class="form-control" min="1" step="1" />
                  </div>
                </div>
                <label class="form-check mt-2">
                  <input class="form-check-input" type="checkbox" id="profit-rule-enabled" checked />
                  <span class="form-check-label">Rule enabled</span>
                </label>
                <div class="d-flex gap-2 mt-3">
                  <button type="button" class="btn btn-primary" id="profit-rule-save-btn">Save rule</button>
                  <button type="button" class="btn btn-ghost-secondary" id="profit-rule-cancel-btn">Cancel</button>
                </div>
              </div>
            </div>
          </div>

          <div class="mb-2 is-hidden" id="profit-rules-tab-integrations">
            <label class="form-check form-switch mb-0">
              <input class="form-check-input" type="checkbox" id="profit-rules-include-google-ads" />
              <span class="form-check-label">Include Google Ads spend in Cost</span>
            </label>
            <div class="text-muted small mt-2">Integrations currently available here: Google Ads.</div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-ghost-secondary" id="profit-rules-dismiss-btn">Close</button>
          <button type="button" class="btn btn-primary" id="profit-rules-save-btn">Save Rules</button>
        </div>
      </div>
    </div>
  </div>

  <!--#include partials/page-body-end.html-->
  <!--#include partials/footer.html-->
  <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/js/tabler.min.js" defer></script>
  <script src="/app.js" defer></script>
  <script src="/pages/insightsSnapshot.js" defer></script>
  <script src="/theme-settings.js" defer></script>
</body>
</html>
