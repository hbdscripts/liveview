'use strict';

function toBooleanMap(keys) {
  const out = {};
  for (const key of keys) out[String(key)] = true;
  return out;
}

// Settings left menu and panel titles no longer use icons; keys unmapped from theme/icon picker.
const LOCKED_SETTINGS_ICON_KEYS = Object.freeze({});

const LEGACY_THEME_ICON_KEYS = Object.freeze(toBooleanMap([
  'mobile-menu',
  'mobile-date',
  'nav-item-theme',
  'footer-sound',
  'footer-sound-muted',
  'footer-theme',
  'footer-settings',
  'footer-signout',
  'table-builder-icon',
]));

const REQUIRED_ACTIVE_ICON_KEYS = Object.freeze([
  'nav-item-admin',
  'footer-settings-toggle',
  'nav-dropdown-arrow',
  'chart-builder-icon',
  'tools-click-order-lookup-search',
  'table-icon-converted-sale',
  'table-icon-compliance-header',
  'table-icon-compliance-check',
  'table-icon-compliance-warning',
  'table-icon-compliance-search',
  'table-sticky-resize-handle',
  'fraud-alert',
]);

const ICON_GLYPH_DEFAULTS = Object.freeze({
  'mobile-menu': 'fa-bars',
  'mobile-date': 'fa-calendar-days',
  'topnav-date-chevron': 'fa-chevron-down',
  'nav-toggle-dashboard': 'fa-table-cells-large',
  'nav-toggle-breakdown': 'fa-chart-pie',
  'nav-toggle-traffic': 'fa-route',
  'nav-toggle-integrations': 'fa-puzzle-piece',
  'nav-toggle-tools': 'fa-screwdriver-wrench',
  'nav-toggle-settings': 'fa-gear',
  'nav-dropdown-arrow': 'fa-solid fa-angle-right',
  'nav-item-overview': 'fa-house',
  'nav-item-live': 'fa-satellite-dish',
  'nav-item-sales': 'fa-cart-shopping',
  'nav-item-table': 'fa-table',
  'nav-item-countries': 'fa-globe',
  'nav-item-products': 'fa-box-open',
  'nav-item-variants': 'fa-bezier-curve',
  'nav-item-channels': 'fa-diagram-project',
  'nav-item-attribution': 'fa-compress',
  'nav-item-type': 'fa-table-cells',
  'nav-item-ads': 'fa-rectangle-ad',
  'nav-item-tools': 'fa-toolbox',
  'nav-item-settings': 'fa-gear',
  'nav-item-refresh': 'fa-rotate-right',
  'nav-item-sound-on': 'fa-volume-high',
  'nav-item-sound-off': 'fa-volume-xmark',
  'nav-item-theme': 'fa-palette',
  'nav-item-signout': 'fa-right-from-bracket',
  'nav-item-admin': 'fa-user-gear',
  'tools-click-order-lookup-search': 'fa-magnifying-glass',
  'table-icon-converted-sale': 'fa-solid fa-sterling-sign',
  'table-icon-compliance-header': 'fa-shield-check',
  'table-icon-compliance-check': 'fa-circle-check',
  'table-icon-compliance-warning': 'fa-triangle-exclamation',
  'table-icon-compliance-search': 'fa-magnifying-glass',
  'fraud-alert': 'fa-jelly-filled fa-triangle-exclamation',
  'footer-refresh': 'fa-rotate-right',
  'footer-cache-reload': 'fa-arrows-rotate',
  'footer-sound': 'fa-volume-high',
  'footer-sound-muted': 'fa-volume-xmark',
  'footer-theme': 'fa-palette',
  'footer-settings': 'fa-gear',
  'footer-settings-toggle': 'fa-gear',
  'footer-signout': 'fa-right-from-bracket',
  'footer-last-sale-show': 'fa-eye',
  'footer-last-sale-hide': 'fa-eye-slash',
  'footer-back-to-top': 'fa-arrow-up',
  'side-panel-close': 'fa-xmark',
  'side-panel-activity': 'fa-list',
  'side-panel-details': 'fa-user',
  'side-panel-source': 'fa-link',
  'side-panel-network': 'fa-cloud',
  'kpi-compare-refresh': 'fa-rotate-right',
  'kpi-compare-close': 'fa-xmark',
  'kpi-compare-date-info': 'fa-circle-info',
  'kexo-score-help': 'fa-jelly fa-question',
  'page-title-separator': 'fa-arrow-turn-down-right',
  'live-landing-entry': 'fa-circle-check',
  'live-landing-exit': 'fa-circle-check',
  'live-bought-overlay': 'fa-cart-shopping',
  'pagination-prev': 'fa-chevron-left',
  'pagination-next': 'fa-chevron-right',
  'breakdown-placeholder-image': 'fa-image',
  'breakdown-icon-image': 'fa-image',
  'breakdown-icon-star': 'fa-star',
  'breakdown-icon-chart-column': 'fa-chart-column',
  'breakdown-icon-link': 'fa-link',
  'type-device-desktop': 'fa-desktop',
  'type-device-mobile': 'fa-mobile-screen',
  'type-device-tablet': 'fa-tablet-screen-button',
  'type-device-unknown': 'fa-globe',
  'type-platform-ios': 'fa-apple',
  'type-platform-mac': 'fa-apple',
  'type-platform-android': 'fa-android',
  'type-platform-windows': 'fa-windows',
  'type-platform-chromeos': 'fa-brands fa-chrome',
  'type-platform-linux': 'fa-linux',
  'type-platform-unknown': 'fa-circle-question',
  'type-browser-chrome': 'fa-brands fa-chrome',
  'type-browser-safari': 'fa-brands fa-safari',
  'type-browser-edge': 'fa-brands fa-edge',
  'type-browser-firefox': 'fa-brands fa-firefox-browser',
  'type-browser-opera': 'fa-brands fa-opera',
  'type-browser-ie': 'fa-brands fa-internet-explorer',
  'type-browser-samsung': 'fa-light fa-globe',
  'type-browser-other': 'fa-light fa-globe',
  'type-browser-unknown': 'fa-circle-question',
  'diag-copy': 'fa-copy',
  'ads-status-warning': 'fa-triangle-exclamation',
  'ads-status-connected': 'fa-circle-check',
  'ads-status-disconnected': 'fa-circle-xmark',
  'ads-actions-refresh': 'fa-rotate-right',
  'ads-actions-audit': 'fa-circle-info',
  'chart-type-area': 'fa-chart-area',
  'chart-type-bar': 'fa-chart-column',
  'chart-type-line': 'fa-chart-line',
  'table-builder-icon': 'fa-light fa-gear',
  'chart-builder-icon': 'fa-light fa-gear',
  'table-sticky-resize-handle': 'fa-solid fa-left-right',
  'card-title-online': 'fa-jelly-filled fa-users',
  'card-title-revenue': 'fa-jelly-filled fa-sterling-sign',
  'card-title-orders': 'fa-jelly-filled fa-box-open',
  'card-title-conversion': 'fa-jelly-filled fa-percent',
  'card-title-sessions': 'fa-jelly-filled fa-users',
  'card-title-countries': 'fa-jelly-filled fa-globe',
  'card-title-products': 'fa-jelly-filled fa-box-open',
  'card-title-channels': 'fa-jelly-filled fa-diagram-project',
  'card-title-type': 'fa-jelly-filled fa-table-cells',
  'card-title-ads': 'fa-brands fa-google',
  'card-title-tools': 'fa-jelly-filled fa-toolbox',
  'card-title-settings': 'fa-jelly-filled fa-gear',
  'card-title-date': 'fa-jelly-filled fa-calendar-days',
  'card-title-dashboard': 'fa-jelly-filled fa-gauge-high',
  'card-title-traffic': 'fa-jelly-filled fa-route',
  'card-title-trending-up': 'fa-jelly-filled fa-arrow-trend-up',
  'card-title-trending-down': 'fa-jelly-filled fa-arrow-trend-down',
  'card-title-chart': 'fa-jelly-filled fa-chart-line',
  'card-title-table-dash-top-products': 'fa-jelly-filled fa-chart-line',
  'card-title-table-dash-top-countries': 'fa-jelly-filled fa-globe',
  'card-title-table-dash-trending-up': 'fa-jelly-filled fa-arrow-trend-up',
  'card-title-table-dash-trending-down': 'fa-jelly-filled fa-arrow-trend-down',
  'card-title-table-latest-sales': 'fa-jelly-filled fa-cart-shopping',
  'card-title-table-sessions': 'fa-jelly-filled fa-users',
  'card-title-table-country': 'fa-jelly-filled fa-map-location-dot',
  'card-title-table-country-product': 'fa-jelly-filled fa-globe-americas',
  'card-title-table-best-sellers': 'fa-jelly-filled fa-trophy',
  'card-title-table-best-variants': 'fa-jelly-filled fa-shapes',
  'card-title-table-necklaces': 'fa-jelly-filled fa-gem',
  'card-title-table-bracelets': 'fa-jelly-filled fa-circle',
  'card-title-table-earrings': 'fa-jelly-filled fa-heart',
  'card-title-table-sets': 'fa-jelly-filled fa-layer-group',
  'card-title-table-charms': 'fa-jelly-filled fa-star',
  'card-title-table-extras': 'fa-jelly-filled fa-puzzle-piece',
  'card-title-table-channels': 'fa-jelly-filled fa-diagram-project',
  'card-title-table-device': 'fa-jelly-filled fa-table-cells',
  'card-title-table-ads': 'fa-brands fa-google',
  'card-title-table-variants': 'fa-jelly-filled fa-bezier-curve',
  'overview-widget-finishes': 'fa-light fa-gem',
  'overview-widget-devices': 'fa-light fa-mobile-screen',
  'overview-widget-browsers': 'fa-light fa-globe',
  'overview-widget-abandoned': 'fa-light fa-globe',
  'overview-widget-attribution': 'fa-light fa-share-nodes',
  'overview-widget-payment_methods': 'fa-light fa-credit-card',
  'payment-method-visa': 'fa-brands fa-cc-visa',
  'payment-method-mastercard': 'fa-brands fa-cc-mastercard',
  'payment-method-amex': 'fa-brands fa-cc-amex',
  'payment-method-discover': 'fa-brands fa-cc-discover',
  'payment-method-diners': 'fa-brands fa-cc-diners-club',
  'payment-method-jcb': 'fa-brands fa-cc-jcb',
  'payment-method-unionpay': 'fa-light fa-credit-card',
  'payment-method-maestro': 'fa-light fa-credit-card',
  'payment-method-paypal': 'fa-brands fa-cc-paypal',
  'payment-method-klarna': 'fa-brands fa-kickstarter-k', // closest available
  'payment-method-afterpay': 'fa-light fa-credit-card',
  'payment-method-affirm': 'fa-light fa-credit-card',
  'payment-method-zip': 'fa-light fa-credit-card',
  'payment-method-sezzle': 'fa-light fa-credit-card',
  'payment-method-apple-pay': 'fa-brands fa-apple-pay',
  'payment-method-google-pay': 'fa-brands fa-google-pay',
  'payment-method-shop-pay': 'fa-light fa-credit-card',
  'payment-method-stripe': 'fa-brands fa-stripe',
  'payment-method-other': 'fa-light fa-credit-card',
  'dash-kpi-delta-up': 'fa-arrow-trend-up',
  'dash-kpi-delta-down': 'fa-arrow-trend-down',
  'dash-kpi-delta-flat': 'fa-minus',
  'online-status-indicator': 'fa-circle',
  'card-collapse-expanded': 'fa-chevron-down',
  'card-collapse-collapsed': 'fa-chevron-right',
  'admin-tab-help-tooltip': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 7C12.5523 7 13 7.44772 13 8C13 8.55229 12.5523 9 12 9C11.4477 9 11 8.55229 11 8C11 7.44772 11.4477 7 12 7ZM13 16C13 16.5523 12.5523 17 12 17C11.4477 17 11 16.5523 11 16V11C11 10.4477 11.4477 10 12 10C12.5523 10 13 10.4477 13 11V16ZM24 12C24 18.6274 18.6274 24 12 24C5.37258 24 0 18.6274 0 12C0 5.37258 5.37258 0 12 0C18.6274 0 24 5.37258 24 12ZM12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z" fill="#758CA3"/></svg>',
  'admin-tab-save-icon': '<svg width="16" height="16" viewBox="0 -0.5 25 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.5 12.5L10.167 17L19.5 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',
  'admin-tab-edit-icon': '<svg width="16" height="16" viewBox="0 -0.5 25 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M17.265 4.16231L19.21 5.74531C19.3978 5.9283 19.5031 6.17982 19.5015 6.44201C19.5 6.70421 19.3919 6.9545 19.202 7.13531L17.724 8.93531L12.694 15.0723C12.6069 15.1749 12.4897 15.2473 12.359 15.2793L9.75102 15.8793C9.40496 15.8936 9.10654 15.6384 9.06702 15.2943L9.18902 12.7213C9.19806 12.5899 9.25006 12.4652 9.33702 12.3663L14.15 6.50131L15.845 4.43331C16.1743 3.98505 16.7938 3.86684 17.265 4.16231Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M5.5 18.2413C5.08579 18.2413 4.75 18.5771 4.75 18.9913C4.75 19.4056 5.08579 19.7413 5.5 19.7413V18.2413ZM19.2 19.7413C19.6142 19.7413 19.95 19.4056 19.95 18.9913C19.95 18.5771 19.6142 18.2413 19.2 18.2413V19.7413ZM14.8455 6.22062C14.6904 5.83652 14.2534 5.65082 13.8693 5.80586C13.4852 5.9609 13.2995 6.39796 13.4545 6.78206L14.8455 6.22062ZM17.8893 9.66991C18.2933 9.57863 18.5468 9.17711 18.4556 8.77308C18.3643 8.36904 17.9628 8.1155 17.5587 8.20678L17.8893 9.66991ZM5.5 19.7413H19.2V18.2413H5.5V19.7413ZM13.4545 6.78206C13.6872 7.35843 14.165 8.18012 14.8765 8.8128C15.6011 9.45718 16.633 9.95371 17.8893 9.66991L17.5587 8.20678C16.916 8.35198 16.3609 8.12551 15.8733 7.69189C15.3725 7.24656 15.0128 6.63526 14.8455 6.22062L13.4545 6.78206Z" fill="currentColor"/></svg>',
});

function getThemeIconGlyphSettingKeys() {
  return Object.keys(ICON_GLYPH_DEFAULTS)
    .sort()
    .map((name) => 'theme_icon_glyph_' + String(name).replace(/-/g, '_'));
}

function cloneObjectMap(map) {
  return Object.assign({}, map || {});
}

function getBrowserRegistryPayload() {
  return {
    iconGlyphDefaults: cloneObjectMap(ICON_GLYPH_DEFAULTS),
    lockedSettingsIconKeys: cloneObjectMap(LOCKED_SETTINGS_ICON_KEYS),
    legacyThemeIconKeys: cloneObjectMap(LEGACY_THEME_ICON_KEYS),
    requiredActiveIconKeys: REQUIRED_ACTIVE_ICON_KEYS.slice(),
    iconGlyphKeys: Object.keys(ICON_GLYPH_DEFAULTS).sort(),
  };
}

module.exports = {
  ICON_GLYPH_DEFAULTS,
  LOCKED_SETTINGS_ICON_KEYS,
  LEGACY_THEME_ICON_KEYS,
  REQUIRED_ACTIVE_ICON_KEYS,
  getThemeIconGlyphSettingKeys,
  getBrowserRegistryPayload,
};
